/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[6,43],{159:function(e,t,s){"use strict";s.r(t),s.d(t,"RulesSettingsLink",(function(){return y})),s.d(t,"default",(function(){return y}));var a=s(1),i=s.n(a),n=s(3),l=s(23),o=s(2),r=s(25),c=s(9),u=s.n(c),d=s(14),g=s(0);const j=o.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.lookBackWindowLabel",{defaultMessage:"Rule run look back window"}),b=o.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.lookBackWindowHelp",{defaultMessage:"The minimum number of runs in which the threshold must be met."}),p=o.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.statusChangeThresholdLabel",{defaultMessage:"Alert status change threshold"}),x=o.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.statusChangeThresholdHelp",{defaultMessage:"The minimum number of times an alert must switch states in the look back window."}),m=e=>o.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.statusChangeThresholdTimes",{defaultMessage:"{amount, number} {amount, plural, one {time} other {times}}",values:{amount:e}}),O=()=>Object(g.jsx)(n.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.alertFlappingDetection",defaultMessage:"Alert flapping detection"}))),h=()=>Object(g.jsx)(n.EuiText,{color:"subdued",size:"s"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.alertFlappingDetectionDescription",defaultMessage:"Modify the frequency that an alert can go between active and recovered over a period of rule runs."})),S=Object(a.memo)((e=>{const{label:t,labelPopoverText:s,min:a,max:i,value:l,disabled:o,onChange:r,...c}=e;return Object(g.jsx)(n.EuiFormRow,{label:Object(g.jsx)("div",null,t," ",Object(g.jsx)(n.EuiIconTip,{color:"subdued",size:"s",type:"questionInCircle",content:s}))},Object(g.jsx)(n.EuiRange,u()({min:a,max:i,step:1,value:l,disabled:o,onChange:r,showLabels:!0,showValue:!0},c)))})),E=Object(a.memo)((e=>{const{flappingSettings:t,compressed:s=!1,onChange:a}=e,{lookBackWindow:c,statusChangeThreshold:u}=t,{application:{capabilities:E}}=Object(r.b)().services,{rulesSettings:{writeFlappingSettingsUI:f}}=E,v=f;return Object(g.jsx)(n.EuiFlexGroup,{direction:"column"},s&&Object(g.jsx)(i.a.Fragment,null,Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(n.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(O,null)),Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(h,null)),Object(g.jsx)(n.EuiSpacer,{size:"s"})))),Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(S,{"data-test-subj":"lookBackWindowRangeInput",min:d.MIN_LOOK_BACK_WINDOW,max:d.MAX_LOOK_BACK_WINDOW,value:c,onChange:e=>a("lookBackWindow",parseInt(e.currentTarget.value,10)),label:j,labelPopoverText:b,disabled:!v})),Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(S,{"data-test-subj":"statusChangeThresholdRangeInput",min:d.MIN_STATUS_CHANGE_THRESHOLD,max:d.MAX_STATUS_CHANGE_THRESHOLD,value:u,onChange:e=>a("statusChangeThreshold",parseInt(e.currentTarget.value,10)),label:p,labelPopoverText:x,disabled:!v})),Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(n.EuiPanel,{borderRadius:"none",color:"subdued"},Object(g.jsx)(n.EuiText,{size:"s"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.flappingSettingsDescription",defaultMessage:"An alert is flapping if it changes status at least {statusChangeThreshold} in the last {lookBackWindow}.",values:{lookBackWindow:Object(g.jsx)("b",null,(I=c,o.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.lookBackWindowLabelRuleRuns",{defaultMessage:"{amount, number} rule {amount, plural, one {run} other {runs}}",values:{amount:I}}))),statusChangeThreshold:Object(g.jsx)("b",null,m(u))}})))));var I}));var f=s(27),v=s(62),I=s(63);const A=o.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.flappingDetectionDescription",{defaultMessage:"Detect alerts that switch quickly between active and recovered states and reduce unwanted noise for these flapping alerts."}),k=o.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.flappingOnLabel",{defaultMessage:"On (recommended)"}),w=o.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.flappingOffLabel",{defaultMessage:"Off"}),F=Object(a.memo)((()=>Object(g.jsx)(n.EuiEmptyPrompt,{"data-test-subj":"rulesSettingsErrorPrompt",color:"danger",iconType:"alert",title:Object(g.jsx)("h4",null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.errorPromptTitle",defaultMessage:"Unable to load your rules settings"})),body:Object(g.jsx)("p",null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.errorPromptBody",defaultMessage:"There was an error loading your rules settings. Contact your administrator for help"}))}))),C=Object(a.memo)((e=>{const{settings:t,onChange:s,isSwitchDisabled:a}=e;return Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(n.EuiFlexGroup,{direction:"column"},Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(n.EuiText,{color:"subdued",size:"s"},Object(g.jsx)("p",null,A))),Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(n.EuiSwitch,{"data-test-subj":"rulesSettingsModalEnableSwitch",label:t.enabled?k:w,checked:t.enabled,disabled:a,onChange:s}))))})),M=Object(a.memo)((e=>{const{settings:t,onChange:s}=e;return t?t.enabled?Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(E,{flappingSettings:t,onChange:s})):Object(g.jsx)(n.EuiFlexItem,{"data-test-subj":"rulesSettingsModalFlappingOffPrompt"},Object(g.jsx)(n.EuiPanel,{borderRadius:"none",color:"subdued",grow:!1},Object(g.jsx)(n.EuiText,{size:"s"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.flappingSettingsOffDescription",defaultMessage:"Alert flapping detection is off. Alerts will be generated based on the rule interval, which might result in higher alert volumes."})))):null})),L=Object(a.memo)((e=>{const{isVisible:t,onClose:s,setUpdatingRulesSettings:i,onSave:c}=e,{application:{capabilities:u}}=Object(r.b)().services,{rulesSettings:{show:d,save:j,writeFlappingSettingsUI:b,readFlappingSettingsUI:p}}=u,[x,m]=Object(a.useState)(),{isLoading:h,isError:S}=(e=>{const{enabled:t,onSuccess:s}=e,{http:a,notifications:{toasts:i}}=Object(r.b)().services,{data:n,isFetching:l,isError:c,isLoadingError:u,isLoading:d}=Object(f.useQuery)({queryKey:["getFlappingSettings"],queryFn:()=>Object(v.k)({http:a}),onError:()=>{i.addDanger(o.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.getRulesSettingsError",{defaultMessage:"Failed to get rules Settings."}))},onSuccess:s,enabled:t,refetchOnWindowFocus:!1,retry:!1});return{isLoading:d||l,isError:c||u,data:n}})({enabled:t,onSuccess:e=>{x||m({enabled:e.enabled,lookBackWindow:e.lookBackWindow,statusChangeThreshold:e.statusChangeThreshold})}}),{mutate:E}=(e=>{const{onSave:t,onClose:s,setUpdatingRulesSettings:a}=e,{http:i,notifications:{toasts:n}}=Object(r.b)().services;return Object(f.useMutation)({mutationFn:e=>Object(v.F)({http:i,flappingSettings:e}),onMutate:()=>{s(),null==a||a(!0)},onSuccess:()=>{n.addSuccess(o.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.updateRulesSettingsSuccess",{defaultMessage:"Rules settings updated successfully."}))},onError:()=>{n.addDanger(o.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.updateRulesSettingsFailure",{defaultMessage:"Failed to update rules settings."}))},onSettled:()=>{null==a||a(!1),null==t||t()}})})({onSave:c,onClose:s,setUpdatingRulesSettings:i}),A=j&&b&&!S,k=d&&p,w=(e,t)=>{if(!x)return;const s={...x,[e]:t};m({...s,statusChangeThreshold:Math.min(s.lookBackWindow,s.statusChangeThreshold)})};return t?Object(g.jsx)(n.EuiModal,{"data-test-subj":"rulesSettingsModal",onClose:s,maxWidth:880},Object(g.jsx)(n.EuiModalHeader,null,Object(g.jsx)(n.EuiModalHeaderTitle,{component:"h3"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.title",defaultMessage:"Rule settings"}))),Object(g.jsx)(n.EuiModalBody,null,Object(g.jsx)(n.EuiCallOut,{size:"s",title:o.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.calloutMessage",{defaultMessage:"Apply to all rules within the current space."})}),Object(g.jsx)(n.EuiHorizontalRule,null),S||!k?Object(g.jsx)(F,null):!x||h?Object(g.jsx)(I.a,null):Object(g.jsx)(n.EuiForm,null,Object(g.jsx)(n.EuiFlexGroup,null,Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(O,null))),Object(g.jsx)(n.EuiSpacer,{size:"s"}),Object(g.jsx)(n.EuiFlexGroup,null,Object(g.jsx)(C,{isSwitchDisabled:!A,settings:x,onChange:e=>w("enabled",e.target.checked)}),Object(g.jsx)(M,{settings:x,onChange:(e,t)=>w(e,t)}))),Object(g.jsx)(n.EuiSpacer,null),Object(g.jsx)(n.EuiHorizontalRule,{margin:"none"})),Object(g.jsx)(n.EuiModalFooter,null,Object(g.jsx)(n.EuiButtonEmpty,{"data-test-subj":"rulesSettingsModalCancelButton",onClick:s},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.cancelButton",defaultMessage:"Cancel"})),Object(g.jsx)(n.EuiButton,{fill:!0,"data-test-subj":"rulesSettingsModalSaveButton",onClick:()=>{x&&E(x)},disabled:!A},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.saveButton",defaultMessage:"Save"})))):null})),y=()=>{const[e,t]=Object(a.useState)(!1),{application:{capabilities:s}}=Object(r.b)().services,{show:o,readFlappingSettingsUI:c}=s.rulesSettings;return o&&c?Object(g.jsx)(i.a.Fragment,null,Object(g.jsx)(n.EuiButtonEmpty,{onClick:()=>t(!0),iconType:"gear","data-test-subj":"rulesSettingsLink"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.link.title",defaultMessage:"Settings"})),Object(g.jsx)(L,{isVisible:e,onClose:()=>t(!1)})):null}},172:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s(1);var a=s(23),i=s(3),n=s(25),l=s(0);const o=()=>{const{docLinks:e}=Object(n.b)().services;return Object(l.jsx)(i.EuiButtonEmpty,{href:e.links.alerting.guide,target:"_blank",iconType:"help","data-test-subj":"documentationLink"},Object(l.jsx)(a.FormattedMessage,{id:"xpack.triggersActionsUI.home.docsLinkText",defaultMessage:"Documentation"}))}},174:function(e,t,s){"use strict";s.d(t,"a",(function(){return G}));var a=s(1),i=s.n(a),n=s(2),l=s(23),o=s(65),r=s.n(o),c=s(3),u=s(25),d=s(4),g=s(149),j=s(63),b=s(171),p=s(123),x=s(0);const m=e=>{var t;return e.includes("now")&&(null===(t=r.a.parse(e))||void 0===t?void 0:t.format())||e},O=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.errorLogColumn.apiError",{defaultMessage:"Failed to fetch error log"}),h=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.errorLogColumn.searchPlaceholder",{defaultMessage:"Search error log message"}),S={iconOnly:!0,fill:!1},E=1e3,f=Object(p.a)((e=>{const{ruleId:t,runId:s,loadActionErrorLog:i,refreshToken:l,spaceId:o,logFromDifferentSpace:r}=e,{uiSettings:d,notifications:j}=Object(u.b)().services,[p,f]=Object(a.useState)([]),[v,I]=Object(a.useState)({pageIndex:0,pageSize:10,totalItemCount:0}),[A,k]=Object(a.useState)({field:"timestamp",direction:"desc"}),[w,F]=Object(a.useState)(""),[C,M]=Object(a.useState)(""),[L,y]=Object(a.useState)(!1),[T,_]=Object(a.useState)("now-24h"),[U,D]=Object(a.useState)("now"),[z]=Object(a.useState)((()=>null==d?void 0:d.get("dateFormat"))),[R]=Object(a.useState)((()=>{var e;return(null==d||null===(e=d.get("timepicker:quickRanges"))||void 0===e?void 0:e.map((({from:e,to:t,display:s})=>({start:e,end:t,label:s}))))||[]})),[B,P]=Object(a.useState)(0),W=Object(a.useRef)(!1),K=Object(a.useMemo)((()=>{const{pageIndex:e,pageSize:t}=v;return(e+1)*t>=E}),[v]),H=Object(a.useMemo)((()=>{if(!A)return;const{field:e,direction:t}=A;return[{[e]:{order:t}}]}),[A]),G=async()=>{y(!0);try{const e=await i({id:t,runId:s,message:w,dateStart:m(T),dateEnd:m(U),page:v.pageIndex,perPage:v.pageSize,sort:H,namespace:o,withAuth:r});f(e.errors),I({...v,totalItemCount:Math.min(e.totalErrors,E)}),P(e.totalErrors)}catch(e){j.toasts.addDanger({title:O,text:e.body.message})}y(!1)},N=Object(a.useCallback)((({start:e,end:t,isInvalid:s})=>{s||(_(e),D(t))}),[_,D]),q=Object(a.useCallback)((e=>{""===e.target.value&&F(""),M(e.target.value)}),[F,M]),V=Object(a.useCallback)((e=>{"Enter"===e.key&&F(C)}),[C,F]),J=Object(a.useMemo)((()=>[{field:"timestamp",name:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.errorLogColumn.timestamp",{defaultMessage:"Timestamp"}),render:e=>Object(x.jsx)(g.c,{columnId:"timestamp",value:e,dateFormat:z}),sortable:!0,width:"250px"},{field:"type",name:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.errorLogColumn.type",{defaultMessage:"Type"}),sortable:!1,width:"100px"},{field:"message",name:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.errorLogColumn.message",{defaultMessage:"Message"}),sortable:!1}]),[z]);return Object(a.useEffect)((()=>{G()}),[T,U,H,v.pageIndex,v.pageSize,w,s]),Object(a.useEffect)((()=>{W.current&&G(),W.current=!0}),[l]),Object(x.jsx)("div",null,Object(x.jsx)(c.EuiSpacer,null),Object(x.jsx)(c.EuiFlexGroup,null,s&&Object(x.jsx)(c.EuiFlexItem,{grow:!1},Object(x.jsx)(c.EuiFieldSearch,{fullWidth:!0,isClearable:!0,value:C,onChange:q,onKeyUp:V,placeholder:h})),Object(x.jsx)(c.EuiFlexItem,{grow:!1},Object(x.jsx)(c.EuiSuperDatePicker,{"data-test-subj":"ruleEventLogListDatePicker",width:"auto",isLoading:L,start:T,end:U,onTimeChange:N,onRefresh:()=>{G()},dateFormat:z,commonlyUsedRanges:R,updateButtonProps:S}))),Object(x.jsx)(c.EuiSpacer,null),L&&Object(x.jsx)(c.EuiProgress,{size:"xs",color:"accent","data-test-subj":"ruleEventLogListProgressBar"}),Object(x.jsx)(c.EuiBasicTable,{"data-test-subj":"RuleErrorLog",loading:L,items:null!=p?p:[],columns:J,sorting:{sort:A},pagination:v,onChange:({page:e,sort:t})=>{e&&I((t=>t.pageIndex!==e.index||t.pageSize!==e.size?{...t,pageIndex:e.index,pageSize:e.size}:t)),t&&k((e=>(null==e?void 0:e.direction)!==t.direction?t:e))}}),K&&Object(x.jsx)(b.a,{documentSize:B,visibleDocumentSize:E,backToTopAnchor:"rule_error_log_list"}))}));var v=s(181);const I=e=>{const{runLog:t,refreshToken:s,onClose:i,activeSpaceId:n}=e,{euiTheme:o}=Object(c.useEuiTheme)(),{id:r,rule_id:u,message:d,num_errored_actions:g,space_ids:j=[]}=t,b=Object(c.useIsWithinBreakpoints)(["xl"]),p=Object(a.useMemo)((()=>Boolean(n&&!(null!=j&&j.includes(n)))),[n,j]);return Object(x.jsx)(c.EuiFlyout,{type:b?"push":"overlay",onClose:i,size:b?"m":"l","data-test-subj":"ruleActionErrorLogFlyout"},Object(x.jsx)(c.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(c.EuiTitle,{size:"m"},Object(x.jsx)("h2",null,Object(x.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.ruleActionErrorLogFlyout.actionErrors",defaultMessage:"Errored Actions"})))),Object(x.jsx)(c.EuiFlyoutBody,null,Object(x.jsx)(c.EuiText,{size:"xs",style:{fontWeight:o.font.weight.bold}},Object(x.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.ruleActionErrorLogFlyout.message",defaultMessage:"Message"})),Object(x.jsx)(c.EuiSpacer,{size:"xs"}),Object(x.jsx)(c.EuiText,{"data-test-subj":"ruleActionErrorLogFlyoutMessageText"},d),Object(x.jsx)(c.EuiHorizontalRule,{size:"full"}),Object(x.jsx)("div",null,Object(x.jsx)(v.a,{totalErrors:g})," ",Object(x.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.ruleActionErrorLogFlyout.actionErrorsPlural",defaultMessage:"{value, plural, one {errored action} other {errored actions}}",values:{value:g}})),Object(x.jsx)(f,{ruleId:u,runId:r,spaceId:j[0],logFromDifferentSpace:p,refreshToken:s}),Object(x.jsx)(c.EuiSpacer,null)),Object(x.jsx)(c.EuiFlyoutFooter,null,Object(x.jsx)(c.EuiButton,{"data-test-subj":"ruleActionErrorLogFlyoutCloseButton",onClick:i},Object(x.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.ruleActionErrorLogFlyout.close",defaultMessage:"Close"}))))};var A=s(172),k=s(52);const w=e=>{var t;return e.includes("now")&&(null===(t=r.a.parse(e))||void 0===t?void 0:t.format())||e},F=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.ruleEventLogListKpi.apiError",{defaultMessage:"Failed to fetch event log KPI."}),C=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.ruleEventLogListKpi.responseTooltip",{defaultMessage:"The responses for up to 10,000 most recent rule runs."}),M=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.ruleEventLogListKpi.alertsTooltip",{defaultMessage:"The alert statuses for up to 10,000 most recent rule runs."}),L=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.ruleEventLogListKpi.actionsTooltip",{defaultMessage:"The action statuses for up to 10,000 most recent rule runs."}),y=Object(p.a)((e=>{var t,s,n,l,o,r,d,j;const{ruleId:b,dateStart:p,dateEnd:m,outcomeFilter:O,message:h,refreshToken:S,namespaces:E,loadExecutionKPIAggregations:f,loadGlobalExecutionKPIAggregations:v}=e,{notifications:{toasts:I}}=Object(u.b)().services,A=Object(a.useRef)(!1),y=Object(k.a)("ruleUseExecutionStatus"),[T,_]=Object(a.useState)(!1),[U,D]=Object(a.useState)(),z=Object(a.useMemo)((()=>"*"===b?v:f),[b,f,v]),R=async()=>{_(!0);try{const e=await z({id:b,dateStart:w(p),dateEnd:w(m),outcomeFilter:O,message:h,...E?{namespaces:E}:{}});D(e)}catch(s){var e,t;I.addDanger({title:F,text:null!==(e=null===(t=s.body)||void 0===t?void 0:t.message)&&void 0!==e?e:s})}_(!1)};Object(a.useEffect)((()=>{R()}),[b,p,m,O,h,E]),Object(a.useEffect)((()=>{A.current&&R(),A.current=!0}),[S]);const B=Object(a.useMemo)((()=>T||!U),[T,U]),P=e=>Object(x.jsx)(i.a.Fragment,null,e,Object(x.jsx)(c.EuiSpacer,{size:"s"}));return Object(x.jsx)(c.EuiFlexGroup,null,Object(x.jsx)(c.EuiFlexItem,{grow:4},Object(x.jsx)(g.g,{title:"Responses",tooltip:C},Object(x.jsx)(c.EuiFlexGroup,null,Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-successOutcome",description:P(Object(x.jsx)(g.d,{status:"success",useExecutionStatus:y})),titleSize:"s",title:null!==(t=null==U?void 0:U.success)&&void 0!==t?t:0,isLoading:B})),Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-warningOutcome",description:P(Object(x.jsx)(g.d,{status:"warning",useExecutionStatus:y})),titleSize:"s",title:null!==(s=null==U?void 0:U.warning)&&void 0!==s?s:0,isLoading:B})),Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-failureOutcome",description:P(Object(x.jsx)(g.d,{status:"failure",useExecutionStatus:y})),titleSize:"s",title:null!==(n=null==U?void 0:U.failure)&&void 0!==n?n:0,isLoading:B}))))),Object(x.jsx)(c.EuiFlexItem,{grow:4},Object(x.jsx)(g.g,{title:"Alerts",tooltip:M},Object(x.jsx)(c.EuiFlexGroup,null,Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-activeAlerts",description:P("Active"),titleSize:"s",title:null!==(l=null==U?void 0:U.activeAlerts)&&void 0!==l?l:0,isLoading:B})),Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-newAlerts",description:P("New"),titleSize:"s",title:null!==(o=null==U?void 0:U.newAlerts)&&void 0!==o?o:0,isLoading:B})),Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-recoveredAlerts",description:P("Recovered"),titleSize:"s",title:null!==(r=null==U?void 0:U.recoveredAlerts)&&void 0!==r?r:0,isLoading:B}))))),Object(x.jsx)(c.EuiFlexItem,{grow:2},Object(x.jsx)(g.g,{title:"Actions",tooltip:L},Object(x.jsx)(c.EuiFlexGroup,null,Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-erroredActions",description:P("Errored"),titleSize:"s",title:null!==(d=null==U?void 0:U.erroredActions)&&void 0!==d?d:0,isLoading:B})),Object(x.jsx)(c.EuiFlexItem,null,Object(x.jsx)(c.EuiStat,{"data-test-subj":"ruleEventLogKpi-triggeredActions",description:P("Triggered"),titleSize:"s",title:null!==(j=null==U?void 0:U.triggeredActions)&&void 0!==j?j:0,isLoading:B}))))))}));var T=s(182),_=s(159);const U=({children:e})=>Object(x.jsx)(i.a.Fragment,null,e),D=e=>{var t;return e.includes("now")&&(null===(t=r.a.parse(e))||void 0===t?void 0:t.format())||e},z=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.apiError",{defaultMessage:"Failed to fetch execution history"}),R=n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.searchPlaceholder",{defaultMessage:"Search event log message"}),B="xpack.triggersActionsUI.ruleEventLogList.initialColumns",P=n.i18n.translate("xpack.triggersActionsUI.ruleEventLogList.showAllSpacesToggle",{defaultMessage:"Show rules from all spaces"}),W={iconOnly:!0,fill:!1},K=1e3,H=e=>{const{ruleId:t,localStorageKey:s=B,refreshToken:o,loadGlobalExecutionLogAggregations:r,loadExecutionLogAggregations:p,overrideLoadGlobalExecutionLogAggregations:m,overrideLoadExecutionLogAggregations:O,initialPageSize:h=10,hasRuleNames:S=!1,hasAllSpaceSwitch:E=!1,setHeaderActions:f}=e,{uiSettings:v,notifications:k}=Object(u.b)().services,[w,F]=Object(a.useState)(""),[C,M]=Object(a.useState)(""),[L,U]=Object(a.useState)(!1),[H,G]=Object(a.useState)(),[N,q]=Object(a.useState)(o),[V,J]=Object(a.useState)(!1),[X,Q]=Object(a.useState)(),[Y,Z]=Object(a.useState)((()=>{var e;return(e=>{const t=e.filter((e=>!d.k.includes(e)));return[...d.k,...t]})(JSON.parse(null!==(e=localStorage.getItem(s))&&void 0!==e?e:"null")||S?d.h:d.l)})),[$,ee]=Object(a.useState)([]),[te,se]=Object(a.useState)([]),[ae,ie]=Object(a.useState)(0),[ne,le]=Object(a.useState)({pageIndex:0,pageSize:h,totalItemCount:0}),[oe,re]=Object(a.useState)(!1),[ce,ue]=Object(a.useState)("now-24h"),[de,ge]=Object(a.useState)("now"),[je]=Object(a.useState)((()=>null==v?void 0:v.get("dateFormat"))),[be]=Object(a.useState)((()=>{var e;return(null==v||null===(e=v.get("timepicker:quickRanges"))||void 0===e?void 0:e.map((({from:e,to:t,display:s})=>({start:e,end:t,label:s}))))||[]})),{onShowAllSpacesChange:pe,canAccessMultipleSpaces:xe,namespaces:me,activeSpace:Oe}=Object(T.a)({setShowFromAllSpaces:J,showFromAllSpaces:V,visibleColumns:Y,setVisibleColumns:Z}),he=Object(a.useRef)(!1),Se=Object(a.useMemo)((()=>{const{pageIndex:e,pageSize:t}=ne;return(e+1)*t>=K}),[ne]),Ee=Object(a.useMemo)((()=>$.map((({id:e,direction:t})=>({[e]:{order:t}})))),[$]);Object(a.useEffect)((()=>(null==f||f([Object(x.jsx)(_.RulesSettingsLink,null),Object(x.jsx)(A.a,null)]),()=>null==f?void 0:f())),[]);const fe=Object(a.useMemo)((()=>"*"===t?null!=m?m:r:null!=O?O:p),[t,O,m,p,r]),ve=async()=>{if(fe){re(!0);try{const e=await fe({id:t,sort:Ee,outcomeFilter:te,message:w,dateStart:D(ce),dateEnd:D(de),page:ne.pageIndex,perPage:ne.pageSize,namespaces:me});Q(e.data),le({...ne,totalItemCount:Math.min(e.total,K)}),ie(e.total)}catch(t){var e,s;k.toasts.addDanger({title:z,text:null!==(e=null===(s=t.body)||void 0===s?void 0:s.message)&&void 0!==e?e:t})}re(!1)}},Ie=Object(a.useCallback)((e=>{const{pageIndex:t,pageSize:s}=ne;return e-t*s}),[ne]),Ae=Object(a.useCallback)((e=>{le((t=>({...t,pageIndex:0,pageSize:e})))}),[le]),ke=Object(a.useCallback)((e=>{le((t=>({...t,pageIndex:e})))}),[le]),we=Object(a.useCallback)((({start:e,end:t,isInvalid:s})=>{s||(ue(e),ge(t))}),[ue,ge]),Fe=Object(a.useCallback)((e=>{le((e=>({...e,pageIndex:0}))),se(e)}),[le,se]),Ce=Object(a.useCallback)((e=>{U(!0),G(e)}),[]),Me=Object(a.useCallback)((()=>{U(!1),G(void 0)}),[]),Le=Object(a.useCallback)((e=>{""===e.target.value&&F(""),M(e.target.value)}),[F,M]),ye=Object(a.useCallback)((e=>{"Enter"===e.key&&F(C)}),[C,F]),Te=Object(a.useMemo)((()=>[...S?[{id:"rule_id",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.ruleId",{defaultMessage:"Rule Id"}),isSortable:Object(g.h)("rule_id"),actions:{showSortAsc:!1,showSortDesc:!1}},{id:"rule_name",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.ruleName",{defaultMessage:"Rule"}),isSortable:Object(g.h)("rule_name"),actions:{showSortAsc:!1,showSortDesc:!1,showHide:!1}}]:[],...V?[{id:"space_ids",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.spaceIds",{defaultMessage:"Space"}),isSortable:Object(g.h)("space_ids"),actions:{showSortAsc:!1,showSortDesc:!1,showHide:!1}}]:[],{id:"id",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.id",{defaultMessage:"Id"}),isSortable:Object(g.h)("id")},{id:"timestamp",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.timestamp",{defaultMessage:"Timestamp"}),isSortable:Object(g.h)("timestamp"),isResizable:!1,actions:{showHide:!1},initialWidth:250},{id:"execution_duration",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.duration",{defaultMessage:"Duration"}),isSortable:Object(g.h)("execution_duration"),isResizable:!1,actions:{showHide:!1},initialWidth:100},{id:"status",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.response",{defaultMessage:"Response"}),actions:{showHide:!1,showSortAsc:!1,showSortDesc:!1,additional:[{iconType:"annotation",label:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.showOnlyFailures",{defaultMessage:"Show only failures"}),onClick:()=>Fe(["failure"]),size:"xs"},{iconType:"annotation",label:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.showAll",{defaultMessage:"Show all"}),onClick:()=>Fe([]),size:"xs"}]},isSortable:Object(g.h)("status"),isResizable:!1,initialWidth:150},{id:"message",actions:{showSortAsc:!1,showSortDesc:!1},displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.message",{defaultMessage:"Message"}),isSortable:Object(g.h)("message"),cellActions:[({rowIndex:e,Component:t})=>{const s=Ie(e),a=(X||[])[s];return(null==a?void 0:a.num_errored_actions)?Object(x.jsx)(t,{onClick:()=>Ce(a),iconType:"alert"},Object(x.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.viewActionErrors",defaultMessage:"View action errors"})):null}]},{id:"num_active_alerts",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.activeAlerts",{defaultMessage:"Active alerts"}),initialWidth:140,isSortable:Object(g.h)("num_active_alerts")},{id:"num_new_alerts",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.newAlerts",{defaultMessage:"New alerts"}),initialWidth:140,isSortable:Object(g.h)("num_new_alerts")},{id:"num_recovered_alerts",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.recoveredAlerts",{defaultMessage:"Recovered alerts"}),isSortable:Object(g.h)("num_recovered_alerts")},{id:"num_triggered_actions",displayAsText:g.l,display:Object(x.jsx)(g.a,{id:"num_triggered_actions"}),isSortable:Object(g.h)("num_triggered_actions")},{id:"num_generated_actions",displayAsText:g.j,display:Object(x.jsx)(g.a,{id:"num_generated_actions"}),isSortable:Object(g.h)("num_generated_actions")},{id:"num_succeeded_actions",displayAsText:g.k,display:Object(x.jsx)(g.a,{id:"num_succeeded_actions"}),isSortable:Object(g.h)("num_succeeded_actions")},{id:"num_errored_actions",actions:{showSortAsc:!1,showSortDesc:!1},displayAsText:g.i,display:Object(x.jsx)(g.a,{id:"num_errored_actions"}),isSortable:Object(g.h)("num_errored_actions")},{id:"total_search_duration",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.totalSearchDuration",{defaultMessage:"Total search duration"}),isSortable:Object(g.h)("total_search_duration")},{id:"es_search_duration",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.esSearchDuration",{defaultMessage:"ES search duration"}),isSortable:Object(g.h)("es_search_duration")},{id:"schedule_delay",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.scheduleDelay",{defaultMessage:"Schedule delay"}),isSortable:Object(g.h)("schedule_delay")},{id:"timed_out",displayAsText:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.eventLogColumn.timedOut",{defaultMessage:"Timed out"}),isSortable:Object(g.h)("timed_out")}]),[Ie,Ce,Fe,S,V,X]);return Object(a.useEffect)((()=>{ve()}),[$,ce,de,te,ne.pageIndex,ne.pageSize,w,V]),Object(a.useEffect)((()=>{he.current&&ve(),he.current=!0}),[o]),Object(a.useEffect)((()=>{localStorage.setItem(s,JSON.stringify(Y))}),[s,Y]),Object(a.useEffect)((()=>{q(o)}),[o]),Object(x.jsx)(c.EuiFlexGroup,{gutterSize:"none",direction:"column"},Object(x.jsx)(c.EuiFlexItem,{grow:!1},Object(x.jsx)(c.EuiFlexGroup,{alignItems:"center"},Object(x.jsx)(c.EuiFlexItem,{grow:!1},Object(x.jsx)(c.EuiFieldSearch,{fullWidth:!0,isClearable:!0,value:C,onChange:Le,onKeyUp:ye,placeholder:R})),Object(x.jsx)(c.EuiFlexItem,{grow:!1},Object(x.jsx)(g.e,{selectedOptions:te,onChange:Fe})),Object(x.jsx)(c.EuiFlexItem,{grow:!1},Object(x.jsx)(c.EuiSuperDatePicker,{"data-test-subj":"ruleEventLogListDatePicker",width:"auto",isLoading:oe,start:ce,end:de,onTimeChange:we,onRefresh:()=>{q(Date.now()),ve()},dateFormat:je,commonlyUsedRanges:be,updateButtonProps:W})),E&&xe&&Object(x.jsx)(c.EuiFlexItem,{"data-test-subj":"showAllSpacesSwitch"},Object(x.jsx)(c.EuiSwitch,{label:P,checked:V,onChange:pe}))),Object(x.jsx)(c.EuiSpacer,null)),Object(x.jsx)(c.EuiFlexItem,{grow:!1},Object(x.jsx)(y,{ruleId:t,dateStart:ce,dateEnd:de,outcomeFilter:te,message:w,refreshToken:N,namespaces:me}),Object(x.jsx)(c.EuiSpacer,null)),Object(x.jsx)(c.EuiFlexItem,null,X?Object(x.jsx)(i.a.Fragment,null,oe&&Object(x.jsx)(c.EuiProgress,{size:"xs",color:"accent","data-test-subj":"ruleEventLogListProgressBar"}),Object(x.jsx)(g.b,{columns:Te,logs:X,pagination:ne,sortingColumns:$,visibleColumns:Y,dateFormat:je,selectedRunLog:H,onChangeItemsPerPage:Ae,onChangePage:ke,onFlyoutOpen:Ce,setVisibleColumns:Z,setSortingColumns:ee})):Object(x.jsx)(j.a,null),Se&&Object(x.jsx)(b.a,{documentSize:ae,visibleDocumentSize:K,backToTopAnchor:"rule_event_log_list"})),L&&H&&Object(x.jsx)(I,{runLog:H,refreshToken:o,onClose:Me,activeSpaceId:null==Oe?void 0:Oe.id}))},G=Object(p.a)((e=>{const{spaces:t}=Object(u.b)().services,s=Object(a.useCallback)(t?t.ui.components.getSpacesContextProvider:U,[t]);return Object(x.jsx)(s,{feature:"triggersActions"},Object(x.jsx)(H,e))}))}}]);