/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[30,54],{105:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleStatusPanel",(function(){return g})),s.d(t,"default",(function(){return x}));var n=s(2),o=s(65),i=s.n(o),a=s(1),l=s(61),u=s.n(l),c=s(23),r=s(3),d=s(6),b=s(123),j=s(94),O=s(0);const g=({rule:e,bulkEnableRules:t,bulkDisableRules:s,snoozeRule:o,unsnoozeRule:l,requestRefresh:b,isEditable:g,healthColor:x,statusMessage:p,loadExecutionLogAggregations:h})=>{const[S,f]=Object(a.useState)(!1),[z,y]=Object(a.useState)(!1),[E,m]=Object(a.useState)(null),R=Object(a.useCallback)((()=>y(!0)),[y]),I=Object(a.useCallback)((()=>y(!1)),[y]),w=Object(a.useCallback)((t=>o(e,t)),[e,o]),L=Object(a.useCallback)((t=>l(e,t)),[e,l]),k=Object(a.useMemo)((()=>{var t;return p||Object(O.jsx)(r.EuiStat,{titleSize:"xs",title:"--",description:"",isLoading:!(null!==(t=e.lastRun)&&void 0!==t&&t.outcome||e.nextRun)})}),[e,p]),C=Object(a.useCallback)((async()=>{try{const t=await h({id:e.id,dateStart:i.a.parse("now-24h").format(),dateEnd:i.a.parse("now").format(),page:0,perPage:10});m(t.total)}catch(e){}}),[h,m,e]);return Object(a.useEffect)((()=>{C()}),[C]),Object(O.jsx)(r.EuiPanel,{"data-test-subj":"ruleStatusPanel",hasBorder:!0,paddingSize:"none"},Object(O.jsx)(r.EuiPanel,{hasShadow:!1},Object(O.jsx)(r.EuiFlexGroup,{justifyContent:"flexStart"},Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiTitle,{size:"xxs"},Object(O.jsx)("h5",null,Object(O.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.rule.statusPanel.ruleIsEnabledDisabledTitle",defaultMessage:"Rule is"})))),Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(d.g,{disableRule:async()=>{await s({ids:[e.id]})},enableRule:async()=>{await t({ids:[e.id]})},snoozeRule:async()=>{},unsnoozeRule:async()=>{},rule:e,onRuleChanged:b,direction:"row",isEditable:g,hideSnoozeOption:!0}))),Object(O.jsx)(r.EuiSpacer,{size:"s"}),Object(O.jsx)(r.EuiText,{size:"s",color:"subdued","data-test-subj":"ruleStatus-numberOfExecutions"},null!==E&&Object(O.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.rule.statusPanel.totalExecutions",defaultMessage:"{executions, plural, one {# execution} other {# executions}} in the last 24 hr",values:{executions:E}}))),Object(O.jsx)(r.EuiHorizontalRule,{margin:"none"}),Object(O.jsx)(r.EuiPanel,{hasShadow:!1},Object(O.jsx)(r.EuiFlexGroup,{gutterSize:"none",direction:"row",responsive:!1},Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiStat,{"data-test-subj":`ruleStatus-${e.executionStatus.status}`,titleSize:"m",descriptionElement:"strong",titleElement:"h5",title:Object(O.jsx)(r.EuiHealth,{"data-test-subj":`ruleStatus-${e.executionStatus.status}`,textSize:"m",color:x,style:{fontWeight:400}},k),description:n.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.rulesList.ruleLastExecutionDescription",{defaultMessage:"Last response"})})),Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiSpacer,{size:"xs"}),Object(O.jsx)(r.EuiText,{color:"subdued",size:"xs"},u()(e.executionStatus.lastExecutionDate).fromNow())))),Object(O.jsx)(r.EuiHorizontalRule,{margin:"none"}),Object(O.jsx)(r.EuiPanel,{hasShadow:!1},Object(O.jsx)(j.RulesListNotifyBadge,{rule:{...e,isEditable:g},isOpen:z,isLoading:S,onLoading:f,onClick:R,onClose:I,onRuleChanged:b,snoozeRule:w,unsnoozeRule:L,showTooltipInline:!0})))},x=Object(b.a)(g)},123:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var n=s(9),o=s.n(n),i=(s(1),s(62)),a=s(25),l=s(0);function u(e){return t=>{const{http:s}=Object(a.b)().services;return Object(l.jsx)(e,o()({},t,{muteRules:async e=>Object(i.x)({http:s,ids:e.filter((e=>!c(e))).map((e=>e.id))}),unmuteRules:async e=>Object(i.D)({http:s,ids:e.filter(c).map((e=>e.id))}),muteRule:async e=>{if(!c(e))return await Object(i.w)({http:s,id:e.id})},unmuteRule:async e=>{if(c(e))return await Object(i.C)({http:s,id:e.id})},muteAlertInstance:async(e,t)=>{if(!r(e,t))return Object(i.v)({http:s,id:e.id,instanceId:t})},unmuteAlertInstance:async(e,t)=>{if(r(e,t))return Object(i.B)({http:s,id:e.id,instanceId:t})},loadRule:async e=>Object(i.q)({http:s,ruleId:e}),loadRuleState:async e=>Object(i.r)({http:s,ruleId:e}),loadRuleSummary:async(e,t)=>Object(i.s)({http:s,ruleId:e,numberOfExecutions:t}),loadRuleTypes:async()=>Object(i.u)({http:s}),loadExecutionLogAggregations:async e=>Object(i.n)({...e,http:s}),loadGlobalExecutionLogAggregations:async e=>Object(i.p)({...e,http:s}),loadActionErrorLog:async e=>Object(i.l)({...e,http:s}),loadExecutionKPIAggregations:async e=>Object(i.m)({...e,http:s}),loadGlobalExecutionKPIAggregations:async e=>Object(i.o)({...e,http:s}),resolveRule:async e=>Object(i.y)({http:s,ruleId:e}),getHealth:async()=>Object(i.a)({http:s}),snoozeRule:async(e,t)=>await Object(i.A)({http:s,id:e.id,snoozeSchedule:t}),bulkSnoozeRules:async e=>await Object(i.e)({http:s,...e}),unsnoozeRule:async(e,t)=>await Object(i.E)({http:s,id:e.id,scheduleIds:t}),bulkUnsnoozeRules:async e=>await Object(i.f)({http:s,...e}),cloneRule:async e=>await Object(i.h)({http:s,ruleId:e}),bulkDeleteRules:async e=>await Object(i.b)({http:s,...e}),bulkEnableRules:async e=>await Object(i.d)({http:s,...e}),bulkDisableRules:async e=>await Object(i.c)({http:s,...e})}))}}function c(e){return!0===e.muteAll}function r(e,t){return e.mutedInstanceIds.findIndex((e=>e===t))>=0}},94:function(e,t,s){"use strict";s.r(t),s.d(t,"RulesListNotifyBadge",(function(){return p})),s.d(t,"SNOOZE_SUCCESS_MESSAGE",(function(){return b})),s.d(t,"UNSNOOZE_SUCCESS_MESSAGE",(function(){return j})),s.d(t,"SNOOZE_FAILED_MESSAGE",(function(){return O})),s.d(t,"default",(function(){return h}));var n=s(1),o=s(25),i=s(62),a=s(61),l=s.n(a),u=s(3),c=s(2),r=s(136),d=s(129);const b=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.snoozeSuccess",{defaultMessage:"Rule successfully snoozed"}),j=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.unsnoozeSuccess",{defaultMessage:"Rule successfully unsnoozed"}),O=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.snoozeFailed",{defaultMessage:"Unable to change rule snooze settings"}),g=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.openSnoozePanel",{defaultMessage:"Open snooze panel"});var x=s(0);const p=e=>{var t,s;const{isLoading:i=!1,rule:a,isOpen:p,onClick:h,onClose:S,onLoading:f,onRuleChanged:z,snoozeRule:y,unsnoozeRule:E,showOnHover:m=!1,showTooltipInline:R=!1}=e,{isSnoozedUntil:I,muteAll:w,isEditable:L}=a,k=w,{notifications:{toasts:C}}=Object(o.b)().services,A=Object(n.useMemo)((()=>(e=>Boolean(e.isSnoozedUntil&&new Date(e.isSnoozedUntil).getTime()>Date.now()||e.muteAll))(a)),[a]),v=Object(n.useMemo)((()=>(e=>{if(!e.snoozeSchedule)return null;const t=e.snoozeSchedule.filter((e=>Boolean(e.id)));return 0===t.length?null:t.reduce(((e,t)=>l()(t.rRule.dtstart).isBefore(l()(e.rRule.dtstart))?t:e))})(a)),[a]),M=Object(n.useMemo)((()=>!A&&Boolean(v)),[v,A]),T=Object(n.useMemo)((()=>I?Object(r.a)(l()(I)):v?Object(r.a)(l()(v.rRule.dtstart)):""),[I,v]),N=Object(n.useMemo)((()=>k?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozedIndefinitelyTooltip",{defaultMessage:"Notifications snoozed indefinitely"}):M?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozeScheduledTooltip",{defaultMessage:"Notifications scheduled to snooze starting {schedStart}",values:{schedStart:Object(r.b)(l()(v.rRule.dtstart))}}):A?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozedTooltip",{defaultMessage:"Notifications snoozing for {snoozeTime}",values:{snoozeTime:l()(I).fromNow(!0)}}):R?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.noSnoozeAppliedTooltip",{defaultMessage:"Notify when alerts generated"}):""),[k,M,A,I,v,R]),U=Object(n.useMemo)((()=>Object(x.jsx)(u.EuiButton,{size:"s",isLoading:i,disabled:i||!L,"data-test-subj":"rulesListNotifyBadge-snoozed","aria-label":g,minWidth:85,iconType:"bellSlash",color:"accent",onClick:h},Object(x.jsx)(u.EuiText,{size:"xs"},T))),[T,i,L,h]),B=Object(n.useMemo)((()=>Object(x.jsx)(u.EuiButton,{size:"s",isLoading:i,disabled:i||!L,"data-test-subj":"rulesListNotifyBadge-scheduled",minWidth:85,iconType:"calendar",color:"text","aria-label":g,onClick:h},Object(x.jsx)(u.EuiText,{size:"xs"},T))),[T,i,L,h]),P=Object(n.useMemo)((()=>{const e=m?"ruleSidebarItem__action":"";return Object(x.jsx)(u.EuiButtonIcon,{size:"s",isLoading:i,disabled:i||!L,display:i?"base":"empty","data-test-subj":"rulesListNotifyBadge-unsnoozed","aria-label":g,className:p||i?"":e,iconType:"bell",onClick:h})}),[p,i,L,m,h]),D=Object(n.useMemo)((()=>Object(x.jsx)(u.EuiButtonIcon,{size:"s",isLoading:i,disabled:i||!L,display:"base","data-test-subj":"rulesListNotifyBadge-snoozedIndefinitely","aria-label":g,iconType:"bellSlash",color:"accent",onClick:h})),[i,L,h]),F=Object(n.useMemo)((()=>M?B:k?D:A?U:P),[A,M,k,B,U,D,P]),_=Object(n.useMemo)((()=>p||R?F:Object(x.jsx)(u.EuiToolTip,{content:N},F)),[p,F,N,R]),G=Object(n.useCallback)((()=>{S()}),[S]),H=Object(n.useCallback)((async e=>{try{f(!0),G(),await y(e),z(),C.addSuccess(b)}catch(e){C.addDanger(O)}finally{f(!1)}}),[f,y,z,C,G]),q=Object(n.useCallback)((async e=>{try{f(!0),G(),await E(e),z(),C.addSuccess(j)}catch(e){C.addDanger(O)}finally{f(!1)}}),[f,E,z,C,G]),W=Object(x.jsx)(u.EuiPopover,{"data-test-subj":"rulesListNotifyBadge",isOpen:p,closePopover:G,button:_,anchorPosition:"rightCenter",panelStyle:{maxHeight:"100vh",overflowY:"auto"}},Object(x.jsx)(d.a,{snoozeRule:H,unsnoozeRule:q,interval:Object(d.b)(I),showCancel:A,scheduledSnoozes:null!==(t=a.snoozeSchedule)&&void 0!==t?t:[],activeSnoozes:null!==(s=a.activeSnoozes)&&void 0!==s?s:[],inPopover:!0}));return R?Object(x.jsx)(u.EuiFlexGroup,{alignItems:"center"},Object(x.jsx)(u.EuiFlexItem,{grow:!1},W),Object(x.jsx)(u.EuiFlexItem,null,Object(x.jsx)(u.EuiText,{color:"subdued",size:"xs"},N))):W},h=e=>{const{onRuleChanged:t,rule:s,isLoading:a,showTooltipInline:l,showOnHover:u}=e,{http:c}=Object(o.b)().services,[r,d]=Object(n.useState)(),[b,j]=Object(n.useState)(!1),[O,g]=Object(n.useState)(s),h=Object(n.useCallback)((e=>Object(i.A)({http:c,id:O.id,snoozeSchedule:e})),[c,O.id]),S=Object(n.useCallback)((e=>Object(i.E)({http:c,id:O.id,scheduleIds:e})),[c,O.id]),f=Object(n.useCallback)((async()=>{const e=await Object(i.q)({http:c,ruleId:O.id});j(!1),g((t=>({...t,activeSnoozes:e.activeSnoozes,isSnoozedUntil:e.isSnoozedUntil,muteAll:e.muteAll,snoozeSchedule:e.snoozeSchedule}))),t()}),[c,O.id,t]),z=Object(n.useCallback)((()=>{d(e.rule.id)}),[e.rule.id]),y=Object(n.useCallback)((()=>{d("")}),[]),E=Object(n.useCallback)((e=>{e&&j(e)}),[]);return Object(x.jsx)(p,{rule:O,isOpen:r===O.id,isLoading:a||b,onClick:z,onClose:y,onLoading:E,onRuleChanged:f,snoozeRule:h,unsnoozeRule:S,showTooltipInline:l,showOnHover:u})}}}]);