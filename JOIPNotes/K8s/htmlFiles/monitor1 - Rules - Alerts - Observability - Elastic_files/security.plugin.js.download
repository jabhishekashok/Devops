/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){function t(t){for(var i,s,r=t[0],o=t[1],a=0,u=[];a<r.length;a++)s=r[a],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&u.push(n[s][0]),n[s]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i]);for(c&&c(t);u.length;)u.shift()()}var i={},n={3:0};function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],i=n[e];if(0!==i)if(i)t.push(i[2]);else{var r=new Promise((function(t,s){i=n[e]=[t,s]}));t.push(i[2]=r);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.src=function(e){return s.p+"security.chunk."+e+".js"}(e);var c=new Error;o=function(t){a.onerror=a.onload=null,clearTimeout(u);var i=n[e];if(0!==i){if(i){var s=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",c.name="ChunkLoadError",c.type=s,c.request=r,i[1](c)}n[e]=void 0}};var u=setTimeout((function(){o({type:"timeout",target:a})}),12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(t)},s.m=e,s.c=i,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var r=window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[],o=r.push.bind(r);r.push=t,r=r.slice();for(var a=0;a<r.length;a++)t(r[a]);var c=o;s(s.s=35)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,i){e.exports=i(24)(2)},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,i){i.r(t);var n=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.ReactRouterDom},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l}));var n=i(3),s=i(5),r=i(0);const o=Object(n.createContext)(void 0),a=({children:e,...t})=>{const i=Object(n.useContext)(o),s=Object(r.jsx)(u,{breadcrumb:t},e);return i?s:Object(r.jsx)(c,null,s)},c=({children:e,onChange:t})=>{const{services:i}=Object(s.useKibana)(),a=Object(n.useRef)([]),c=e=>{const n=e.map(((t,i)=>i===e.length-1?{...t,href:void 0}:t));t?t(n):i.chrome&&l(i.chrome)(n)};return Object(r.jsx)(o.Provider,{value:{parents:[],onMount:e=>{e.length>a.current.length&&(a.current=e,c(e))},onUnmount:e=>{e.length<a.current.length&&(a.current=e,c(e))}}},e)},u=({breadcrumb:e,children:t})=>{const{parents:i,onMount:s,onUnmount:a}=Object(n.useContext)(o),c=[...i,e];return Object(n.useEffect)((()=>(s(c),()=>a(i))),[e.text,e.href]),Object(r.jsx)(o.Provider,{value:{parents:c,onMount:s,onUnmount:a}},t)};function l(e,t=e.setBreadcrumbs){return i=>{t(i),0===i.length?e.docTitle.reset():e.docTitle.change(function(e,t=2){return e.slice(0,t).reverse().map((({text:e})=>e))}(i))}}},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return a})),i.d(t,"h",(function(){return c})),i.d(t,"j",(function(){return u})),i.d(t,"g",(function(){return l})),i.d(t,"f",(function(){return h})),i.d(t,"m",(function(){return d})),i.d(t,"k",(function(){return p})),i.d(t,"i",(function(){return b})),i.d(t,"l",(function(){return f})),i.d(t,"n",(function(){return g}));const n="*",s="auth_provider_hint",r="auth_url_hash",o="provider",a="msg",c="next",u="kbn-session-error-reason",l=/^(?! )[a-zA-Z0-9 !"#$%&'()*+,\-./\\:;<=>?@\[\]^_`{|}~]*[a-zA-Z0-9!"#$%&'()*+,\-./\\:;<=>?@\[\]^_`{|}~]$/,h=1024,d=5e3,p=3e5,b=1e3,f=6e4,g="/internal/security/session"},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t,i){e.exports=i(24)(3)},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"a",(function(){return a.a})),i.d(t,"e",(function(){return a.c})),i.d(t,"c",(function(){return a.b}));var n=i(23),s=i.n(n);const[r,o]=s()((({userProfiles:e,users:t})=>({userProfiles:e,users:t})));var a=i(15)},function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return p}));var n=i(23),s=i.n(n),r=i(29),o=i.n(r),a=i(16),c=i.n(a),u=i(14);const[l,h]=s()((({authc:e})=>e));function d(){const e=h();return o()(e.getCurrentUser,[e])}function p(e){const{userProfiles:t}=Object(u.d)(),i=c()(t.dataUpdates$);return o()((()=>t.getCurrent(e?{dataPath:e}:void 0)),[t,i])}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(26),s=i(3),r=n.__importDefault(i(38));t.default=function(e,t){var i=s.useState(t),n=i[0],o=i[1];return r.default((function(){var t=e.subscribe(o);return function(){return t.unsubscribe()}}),[e]),n}},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i(4),s=i(3),r=i(5),o=i(30);const a=({featureId:e,tooltip:t})=>{const{save:i}=Object(o.a)(e);return function(e,t=[null==e?void 0:e.iconType,null==e?void 0:e.text,null==e?void 0:e.tooltip]){const{services:i}=Object(r.useKibana)();Object(s.useEffect)((()=>{if(e)return i.chrome.setBadge(e),()=>i.chrome.setBadge()}),t)}(i?void 0:{iconType:"glasses",text:n.i18n.translate("xpack.security.management.readonlyBadge.text",{defaultMessage:"Read only"}),tooltip:t},[i]),null}},function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));const n=e=>{try{return decodeURIComponent(e)}catch{return e}}},function(e,t,i){"use strict";i.d(t,"f",(function(){return r})),i.d(t,"g",(function(){return o})),i.d(t,"h",(function(){return s})),i.d(t,"b",(function(){return l})),i.d(t,"a",(function(){return h})),i.d(t,"o",(function(){return c})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return _})),i.d(t,"j",(function(){return g})),i.d(t,"l",(function(){return j})),i.d(t,"m",(function(){return f})),i.d(t,"n",(function(){return m})),i.d(t,"i",(function(){return v})),i.d(t,"k",(function(){return b})),i.d(t,"p",(function(){return S})),i.d(t,"e",(function(){return y}));var n=i(2);function s(e){return e.full_name||e.email||e.username}function r(e,t){if(t&&t.color)return t.color;const i=s(e).codePointAt(0)||97;return n.VISUALIZATION_COLORS[i%n.VISUALIZATION_COLORS.length]}function o(e,t){if(t&&t.initials)return t.initials;const i=s(e).split(" "),n=Math.min(2,i.length);return i.splice(n,i.length),i.map((e=>e.substring(0,1))).join("")}const a=["reserved","native"];function c(e){return"anonymous"===e.authentication_provider.type}function u(e){return!c(e)&&"http"!==e.authentication_provider.type}function l(e){return a.includes(e.authentication_realm.type)&&!c(e)}function h(e,t){return"native"===e.authentication_realm.type&&t.management.security.users}var d=i(21),p=i(4);function b(e){var t,i;return null===(t=null===(i=e.transient_metadata)||void 0===i?void 0:i.enabled)||void 0===t||t}function f(e){var t,i;return null!==(t=null===(i=e.metadata)||void 0===i?void 0:i._reserved)&&void 0!==t&&t}function g(e){var t,i;return null!==(t=null===(i=e.metadata)||void 0===i?void 0:i._deprecated)&&void 0!==t&&t}function m(e){var t,i;return null!==(t=f(e)&&(null===(i=e.name)||void 0===i?void 0:i.endsWith("_system")))&&void 0!==t&&t}function v(e){var t,i;return null!==(t=f(e)&&((null===(i=e.name)||void 0===i?void 0:i.endsWith("_admin"))||"superuser"===e.name))&&void 0!==t&&t}function y(e){return p.i18n.translate("xpack.security.common.extendedRoleDeprecationNotice",{defaultMessage:"The {roleName} role is deprecated. {reason}",values:{roleName:e.name,reason:x(e)}})}function j(e){var t,i;return f(e)||(null!==(t=null===(i=e._transform_error)||void 0===i?void 0:i.length)&&void 0!==t?t:0)>0}function _(e){return Object(d.cloneDeep)(e)}function S(e){const t=_(e);return t.name="",t}function x(e){var t,i;return null!==(t=null===(i=e.metadata)||void 0===i?void 0:i._deprecated_reason)&&void 0!==t?t:""}},function(e,t,i){"use strict";i.r(t),i.d(t,"UserAPIClient",(function(){return n.UserAPIClient})),i.d(t,"usersManagementApp",(function(){return b}));var n=i(22),s=(i(3),i(9)),r=i(6),o=i(4),a=i(7),c=i(5),u=i(8),l=i(15),h=i(17),d=i(18),p=i(0);const b=Object.freeze({id:"users",create({authc:e,getStartServices:t}){const n=o.i18n.translate("xpack.security.management.usersTitle",{defaultMessage:"Users"});return{id:this.id,order:10,title:n,async mount({element:n,theme$:a,setBreadcrumbs:c,history:l}){const[[b],{UsersGridPage:g},{CreateUserPage:m,EditUserPage:v},{UserAPIClient:y},{RolesAPIClient:j}]=await Promise.all([t(),i.e(12).then(i.bind(null,298)),i.e(9).then(i.bind(null,296)),Promise.resolve().then(i.bind(null,22)),Promise.resolve().then(i.bind(null,28))]);return Object(s.render)(Object(p.jsx)(f,{services:b,theme$:a,history:l,authc:e,onChange:Object(u.c)(b.chrome,c)},Object(p.jsx)(h.a,{featureId:"users",tooltip:o.i18n.translate("xpack.security.management.users.readonlyTooltip",{defaultMessage:"Unable to create or edit users"})}),Object(p.jsx)(u.a,{text:o.i18n.translate("xpack.security.users.breadcrumb",{defaultMessage:"Users"}),href:"/"},Object(p.jsx)(r.Switch,null,Object(p.jsx)(r.Route,{path:["/",""],exact:!0},Object(p.jsx)(g,{notifications:b.notifications,userAPIClient:new y(b.http),rolesAPIClient:new j(b.http),history:l,navigateToApp:b.application.navigateToApp,readOnly:!b.application.capabilities.users.save})),Object(p.jsx)(r.Route,{path:"/create"},Object(p.jsx)(u.a,{text:o.i18n.translate("xpack.security.users.editUserPage.createBreadcrumb",{defaultMessage:"Create"}),href:"/create"},Object(p.jsx)(m,null))),Object(p.jsx)(r.Route,{path:"/edit/:username",render:e=>{const t=Object(d.a)(e.match.params.username);return Object(p.jsx)(u.a,{text:t,href:`/edit/${encodeURIComponent(t)}`},Object(p.jsx)(v,{username:t}))}}),Object(p.jsx)(r.Route,{path:"/edit"},Object(p.jsx)(r.Redirect,{to:"/create"}))))),n),()=>{Object(s.unmountComponentAtNode)(n)}}}}}),f=({services:e,theme$:t,history:i,authc:n,onChange:s,children:o})=>Object(p.jsx)(c.KibanaContextProvider,{services:e},Object(p.jsx)(l.a,{authc:n},Object(p.jsx)(a.I18nProvider,null,Object(p.jsx)(c.KibanaThemeProvider,{theme$:t},Object(p.jsx)(r.Router,{history:i},Object(p.jsx)(u.b,{onChange:s},o))))))},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,i){"use strict";i.r(t),i.d(t,"UserAPIClient",(function(){return UserAPIClient}));const n="/internal/security/users";class UserAPIClient{constructor(e){this.http=e}async getUsers(){return await this.http.get(n)}async getUser(e){return await this.http.get(`${n}/${encodeURIComponent(e)}`)}async deleteUser(e){await this.http.delete(`${n}/${encodeURIComponent(e)}`)}async saveUser(e){await this.http.post(`${n}/${encodeURIComponent(e.username)}`,{body:JSON.stringify(e)})}async changePassword(e,t,i){const s={newPassword:t};i&&(s.password=i),await this.http.post(`${n}/${encodeURIComponent(e)}/password`,{body:JSON.stringify(s)})}async disableUser(e){await this.http.post(`${n}/${encodeURIComponent(e)}/_disable`)}async enableUser(e){await this.http.post(`${n}/${encodeURIComponent(e)}/_enable`)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3);function s(e,t){if(null==e)return{};var i,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(s[i]=e[i]);return s}var r={};function o(e){return function(){return n.useContext(e)}}t.default=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];var c=[],u=[],l=function(e){var t=n.createContext(r);c.push(t),u.push(o(t))};i.length?i.forEach((function(e){return l(e.name)})):l(e.name);var h=function(t){for(var r=t.children,o=s(t,["children"]),a=e(o),u=r,l=0;l<c.length;l+=1){var h=c[l],d=i[l]||function(e){return e};u=n.createElement(h.Provider,{value:d(a)},u)}return u};return[h].concat(u)}},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(26),s=i(3),r=n.__importDefault(i(37));t.default=function(e,t,i){void 0===t&&(t=[]),void 0===i&&(i={loading:!1});var o=s.useRef(0),a=r.default(),c=s.useState(i),u=c[0],l=c[1],h=s.useCallback((function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=++o.current;return l((function(e){return n.__assign(n.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return a()&&s===o.current&&l({value:e,loading:!1}),e}),(function(e){return a()&&s===o.current&&l({error:e,loading:!1}),e}))}),t);return[u,h]}},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(12),s=i.n(n),r=i(2);function o(e,t){if(t&&t.color)return t.color;const i=c(e).codePointAt(0)||97;return r.VISUALIZATION_COLORS[i%r.VISUALIZATION_COLORS.length]}function a(e,t){if(t&&t.initials)return t.initials;const i=c(e).split(" "),n=Math.min(2,i.length);return i.splice(n,i.length),i.map((e=>e.substring(0,1))).join("")}function c(e){return e.full_name||e.email||e.username}i(3);var u=i(0);const l=({user:e,avatar:t,...i})=>{const{euiTheme:n}=Object(r.useEuiTheme)();if(!e)return Object(u.jsx)(r.EuiAvatar,s()({name:"",color:n.colors.lightestShade,initials:"?"},i));const l=c(e);return null!=t&&t.imageUrl?Object(u.jsx)(r.EuiAvatar,s()({name:l,imageUrl:t.imageUrl,color:"plain"},i)):Object(u.jsx)(r.EuiAvatar,s()({name:l,initials:a(e,t),initialsLength:2,color:o(e,t)},i))};i(4),i(7)},function(e,t,i){"use strict";i.r(t),i.d(t,"rolesManagementApp",(function(){return h})),i.d(t,"RolesAPIClient",(function(){return d.RolesAPIClient})),i(3);var n=i(9),s=i(6),r=i(4),o=i(5),a=i(8),c=i(17),u=i(18),l=i(0);const h=Object.freeze({id:"roles",create({license:e,fatalErrors:t,getStartServices:h}){const d=r.i18n.translate("xpack.security.management.rolesTitle",{defaultMessage:"Roles"});return{id:this.id,order:20,title:d,async mount({element:p,theme$:b,setBreadcrumbs:f,history:g}){const[[m,{dataViews:v,features:y,spaces:j}],{RolesGridPage:_},{EditRolePage:S},{RolesAPIClient:x},{IndicesAPIClient:O},{PrivilegesAPIClient:w},{UserAPIClient:A}]=await Promise.all([h(),i.e(13).then(i.bind(null,297)),i.e(5).then(i.bind(null,290)),Promise.resolve().then(i.bind(null,31)),i.e(19).then(i.bind(null,286)),i.e(20).then(i.bind(null,287)),Promise.resolve().then(i.bind(null,20))]),{application:P,docLinks:C,http:k,i18n:I,notifications:E,chrome:T}=m;T.docTitle.change(d);const M=new x(k),R=({action:i})=>{const{roleName:n}=Object(s.useParams)(),o=n?Object(u.a)(n):void 0,c="edit"===i&&n&&o?{text:o,href:`/edit/${encodeURIComponent(n)}`}:{text:r.i18n.translate("xpack.security.roles.createBreadcrumb",{defaultMessage:"Create"})},h=null==j?void 0:j.ui;return Object(l.jsx)(a.a,{text:c.text,href:c.href},Object(l.jsx)(S,{action:i,roleName:o,rolesAPIClient:M,userAPIClient:new A(k),indicesAPIClient:new O(k),privilegesAPIClient:new w(k),getFeatures:y.getFeatures,http:k,notifications:E,fatalErrors:t,license:e,docLinks:C,uiCapabilities:P.capabilities,dataViews:v,history:g,spacesApiUi:h}))};return Object(n.render)(Object(l.jsx)(o.KibanaContextProvider,{services:m},Object(l.jsx)(I.Context,null,Object(l.jsx)(o.KibanaThemeProvider,{theme$:b},Object(l.jsx)(s.Router,{history:g},Object(l.jsx)(c.a,{featureId:"roles",tooltip:r.i18n.translate("xpack.security.management.roles.readonlyTooltip",{defaultMessage:"Unable to create or edit roles"})}),Object(l.jsx)(a.b,{onChange:Object(a.c)(T,f)},Object(l.jsx)(a.a,{text:d,href:"/"},Object(l.jsx)(s.Route,{path:["/",""],exact:!0},Object(l.jsx)(_,{notifications:E,rolesAPIClient:M,history:g,readOnly:!m.application.capabilities.roles.save})),Object(l.jsx)(s.Route,{path:"/edit/:roleName?"},Object(l.jsx)(R,{action:"edit"})),Object(l.jsx)(s.Route,{path:"/clone/:roleName"},Object(l.jsx)(R,{action:"clone"})))))))),p),()=>{Object(n.unmountComponentAtNode)(p)}}}}});var d=i(31)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(26),s=i(3),r=n.__importDefault(i(25));t.default=function(e,t){void 0===t&&(t=[]);var i=r.default(e,t,{loading:!0}),n=i[0],o=i[1];return s.useEffect((function(){o()}),[o]),n}},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(5);function s(e){const{services:t}=Object(n.useKibana)();return e?t.application.capabilities[e]:t.application.capabilities}},function(e,t,i){"use strict";i.r(t),i.d(t,"RolesAPIClient",(function(){return RolesAPIClient}));var n=i(19);class RolesAPIClient{constructor(e){this.http=e}async getRoles(){return await this.http.get("/api/security/role")}async getRole(e){return await this.http.get(`/api/security/role/${encodeURIComponent(e)}`)}async deleteRole(e){await this.http.delete(`/api/security/role/${encodeURIComponent(e)}`)}async saveRole({role:e,createOnly:t=!1}){await this.http.put(`/api/security/role/${encodeURIComponent(e.name)}`,{body:JSON.stringify(this.transformRoleForSave(Object(n.d)(e))),query:{createOnly:t}})}transformRoleForSave(e){return e.elasticsearch.indices=e.elasticsearch.indices.filter((e=>!(e=>0===e.names.length)(e))),e.elasticsearch.indices.forEach((e=>e.query||delete e.query)),e.kibana.forEach((e=>{e.base.length>0&&(e.feature={})})),delete e.name,delete e.transient_metadata,delete e._unrecognized_applications,delete e._transform_error,e}}},function(e,t,i){"use strict";i.d(t,"b",(function(){return p})),i.d(t,"a",(function(){return b})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return u}));var n=i(3),s=i.n(n),r=i(16),o=i.n(r),a=i(0);const c=s.a.createContext(null),u=({children:e,...t})=>{const{navigateToUrl:i,currentAppId:n}=t;return Object(a.jsx)(c.Provider,{value:{navigateToUrl:i,currentAppId:n}},e)},l=({children:e,coreStart:t})=>{const{navigateToUrl:i,currentAppId$:n}=t.application,s=o()(n,void 0);return Object(a.jsx)(c.Provider,{value:{navigateToUrl:i,currentAppId:s}},e)};i(2),i(12);const h={name:"36bnqj",styles:"display:flex;flex:1"},d=({children:e,navigateToUrl:t,currentAppId:i})=>{const s=Object(n.useRef)(null),r=Object(n.useCallback)((e=>(({event:e,container:t,navigateToUrl:i,currentAppId:n})=>{if(!t||!n)return;const s=((e,t)=>{let i=e;do{var n,s;if("a"===(null===(n=i)||void 0===n?void 0:n.tagName.toLowerCase()))return i;const e=null===(s=i)||void 0===s?void 0:s.parentElement;if(!e||e===document.body||e===t)break;i=e}while(parent||parent!==document.body||parent!==t)})(e.target,t);if(!s)return;const r=s.href,o=""===s.target||"_self"===s.target,a=0===e.button;r&&o&&a&&!e.defaultPrevented&&!(e=>e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)(e)&&(e.preventDefault(),i(s.href))})({event:e,currentAppId:i,navigateToUrl:t,container:s.current})),[i,t]);return Object(a.jsx)("div",{onClick:r,ref:s,css:h},e)},p=({children:e})=>Object(a.jsx)(d,function(){const e=Object(n.useContext)(c);if(!e)throw new Error("RedirectAppLinksContext is missing.  Ensure your component or React root is wrapped with RedirectAppLinksProvider.");return e}(),e),b=({children:e,...t})=>{const i=Object(a.jsx)(p,null,e);if(void 0!==t.coreStart){const{coreStart:e}=t;return Object(a.jsx)(l,{coreStart:e},i)}const{navigateToUrl:n,currentAppId:s}=t;return Object(a.jsx)(u,{currentAppId:s,navigateToUrl:n},i)}},function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return Sha256}));var n=i(1),s=i.n(n);const r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=new Array(64);class Sha256{constructor(){s()(this,"_a",void 0),s()(this,"_b",void 0),s()(this,"_c",void 0),s()(this,"_d",void 0),s()(this,"_e",void 0),s()(this,"_f",void 0),s()(this,"_g",void 0),s()(this,"_h",void 0),s()(this,"_block",void 0),s()(this,"_finalSize",void 0),s()(this,"_blockSize",void 0),s()(this,"_len",void 0),s()(this,"_s",void 0),s()(this,"_w",void 0),this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this._w=o,this._block=e.alloc(64),this._finalSize=56,this._blockSize=64,this._len=0,this._s=0}update(t,i){"string"==typeof t&&(i=i||"utf8",t=e.from(t,i));const n=this._len+=t.length;let s=this._s||0,r=0;const o=this._block;for(;s<n;){const e=Math.min(t.length,r+this._blockSize-s%this._blockSize)-r;for(let i=0;i<e;i++)o[s%this._blockSize+i]=t[i+r];s+=e,r+=e,s%this._blockSize==0&&this._update(o)}return this._s=s,this}digest(e){const t=8*this._len;return this._block[this._len%this._blockSize]=128,this._block.fill(0,this._len%this._blockSize+1),t%(8*this._blockSize)>=8*this._finalSize&&(this._update(this._block),this._block.fill(0)),this._block.writeInt32BE(t,this._blockSize-4),this._update(this._block),this._hash().toString(e)}_update(e){const t=this._w;let i,n=0|this._a,s=0|this._b,o=0|this._c,d=0|this._d,p=0|this._e,b=0|this._f,f=0|this._g,g=0|this._h;for(i=0;i<16;++i)t[i]=e.readInt32BE(4*i);for(;i<64;++i)t[i]=0|(((m=t[i-2])>>>17|m<<15)^(m>>>19|m<<13)^m>>>10)+t[i-7]+h(t[i-15])+t[i-16];var m;for(let e=0;e<64;++e){const i=g+l(p)+a(p,b,f)+r[e]+t[e]|0,h=u(n)+c(n,s,o)|0;g=f,f=b,b=p,p=d+i|0,d=o,o=s,s=n,n=i+h|0}this._a=n+this._a|0,this._b=s+this._b|0,this._c=o+this._c|0,this._d=d+this._d|0,this._e=p+this._e|0,this._f=b+this._f|0,this._g=f+this._g|0,this._h=g+this._h|0}_hash(){const t=e.alloc(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t}}function a(e,t,i){return i^e&(t^i)}function c(e,t,i){return e&t|i&(e|t)}function u(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function l(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function h(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}}).call(this,i(39).Buffer)},function(e,t,i){i.r(t);var n=__kbnBundles__.get("entry/core/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,i){i(36),__kbnBundles__.define("plugin/security/public",i,40)},function(e,t,i){i.p=window.__kbnPublicPath__.security},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3);t.default=function(){var e=n.useRef(!1),t=n.useCallback((function(){return e.current}),[]);return n.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),s="undefined"!=typeof window?n.useLayoutEffect:n.useEffect;t.default=s},function(e,t,i){e.exports=i(24)(2813)},function(e,t,i){"use strict";i.r(t),i.d(t,"ALL_SPACES_ID",(function(){return O.a})),i.d(t,"plugin",(function(){return ue}));var n=i(1),s=i.n(n),r=i(4),o=i(13);class license_service_SecurityLicenseService{constructor(){s()(this,"licenseSubscription",void 0)}setup({license$:e}){let t;return this.licenseSubscription=e.subscribe((e=>{t=e})),{license:Object.freeze({isLicenseAvailable:()=>{var e,i;return null!==(e=null===(i=t)||void 0===i?void 0:i.isAvailable)&&void 0!==e&&e},isEnabled:()=>this.isSecurityEnabledFromRawLicense(t),hasAtLeast:e=>{var i;return null===(i=t)||void 0===i?void 0:i.hasAtLeast(e)},getFeatures:()=>this.calculateFeaturesFromRawLicense(t),features$:e.pipe(Object(o.map)((e=>this.calculateFeaturesFromRawLicense(e))))})}}stop(){this.licenseSubscription&&(this.licenseSubscription.unsubscribe(),this.licenseSubscription=void 0)}isSecurityEnabledFromRawLicense(e){if(!e)return!1;const t=e.getFeature("security");return void 0!==t&&t.isAvailable&&t.isEnabled}calculateFeaturesFromRawLicense(e){if(null==e||!e.isAvailable)return{showLogin:!0,allowLogin:!1,showLinks:!1,showRoleMappingsManagement:!1,allowAccessAgreement:!1,allowAuditLogging:!1,allowRoleDocumentLevelSecurity:!1,allowRoleFieldLevelSecurity:!1,allowRbac:!1,allowSubFeaturePrivileges:!1,allowUserProfileCollaboration:!1,layout:void 0===e||null!=e&&e.isAvailable?"error-es-unavailable":"error-xpack-unavailable"};if(!this.isSecurityEnabledFromRawLicense(e))return{showLogin:!1,allowLogin:!1,showLinks:!1,showRoleMappingsManagement:!1,allowAccessAgreement:!1,allowAuditLogging:!1,allowRoleDocumentLevelSecurity:!1,allowRoleFieldLevelSecurity:!1,allowRbac:!1,allowSubFeaturePrivileges:!1,allowUserProfileCollaboration:!1};const t=e.hasAtLeast("standard"),i=e.hasAtLeast("gold"),n=e.hasAtLeast("platinum");return{showLogin:!0,allowLogin:!0,showLinks:!0,showRoleMappingsManagement:i,allowAccessAgreement:i,allowAuditLogging:i,allowSubFeaturePrivileges:i,allowRoleDocumentLevelSecurity:n,allowRoleFieldLevelSecurity:n,allowRbac:!0,allowUserProfileCollaboration:t}}}var a=i(3),c=i.n(a),u=i(9),l=i.n(u),h=i(6),d=i(34),p=i(7),b=i(5),f=i(14),g=i(8),m=i(0);const v=Object.freeze({id:"security_account",create({application:e,authc:t,getStartServices:n,securityApiClients:s}){e.register({id:this.id,title:r.i18n.translate("xpack.security.account.breadcrumb",{defaultMessage:"User settings"}),navLinkStatus:d.AppNavLinkStatus.hidden,appRoute:"/security/account",async mount({element:e,theme$:r,history:o}){const[[a],{AccountManagementPage:c}]=await Promise.all([n(),i.e(6).then(i.bind(null,293))]);return Object(u.render)(Object(m.jsx)(y,{services:a,theme$:r,history:o,authc:t,securityApiClients:s},Object(m.jsx)(c,null)),e),()=>Object(u.unmountComponentAtNode)(e)}})}}),y=({services:e,theme$:t,history:i,authc:n,securityApiClients:s,onChange:r,children:o})=>Object(m.jsx)(b.KibanaContextProvider,{services:e},Object(m.jsx)(f.a,{authc:n},Object(m.jsx)(f.b,s,Object(m.jsx)(p.I18nProvider,null,Object(m.jsx)(b.KibanaThemeProvider,{theme$:t},Object(m.jsx)(h.Router,{history:i},Object(m.jsx)(g.b,{onChange:r},o)))))));var j=i(11);class user_profile_api_client_UserProfileAPIClient{constructor(e){s()(this,"internalDataUpdates$",new j.Subject),s()(this,"dataUpdates$",this.internalDataUpdates$.asObservable()),this.http=e}getCurrent(e){return this.http.get("/internal/security/user_profile",{query:{dataPath:null==e?void 0:e.dataPath}})}bulkGet(e){return this.http.post("/internal/security/user_profile/_bulk_get",{body:JSON.stringify({...e,uids:[...e.uids]})})}suggest(e,t){return this.http.post(e,{body:JSON.stringify(t)})}update(e){return this.http.post("/internal/security/user_profile/_data",{body:JSON.stringify(e)}).then((()=>{this.internalDataUpdates$.next(e)}))}}var _=i(33);class analytics_service_AnalyticsService{constructor(){s()(this,"securityLicense",void 0),s()(this,"securityFeaturesSubscription",void 0)}setup({analytics:e,authc:t,cloudId:i,http:n,securityLicense:s}){this.securityLicense=s,!1===n.anonymousPaths.isAnonymous(window.location.pathname)&&function(e,t,i){e.registerContextProvider({name:"user_id",context$:Object(j.from)(t.getCurrentUser()).pipe(Object(j.map)((e=>e.elastic_cloud_user?{userId:e.username,isElasticCloudUser:!0}:{userId:i?`${i}:${e.username}`:e.username,isElasticCloudUser:!1})),Object(j.map)((({userId:e,isElasticCloudUser:t})=>{return{userId:(i=e,(new _.a).update(i,"utf8").digest("hex")),isElasticCloudUser:t};var i})),Object(j.catchError)((()=>Object(j.of)({userId:void 0,isElasticCloudUser:!1})))),schema:{userId:{type:"keyword",_meta:{description:"The user id scoped as seen by Cloud (hashed)",optional:!0}},isElasticCloudUser:{type:"boolean",_meta:{description:"`true` if the user is managed by ESS."}}}})}(e,t,i)}start({http:e}){this.securityFeaturesSubscription=this.securityLicense.features$.pipe(Object(j.filter)((({allowLogin:e})=>e)),Object(o.throttleTime)(5e3)).subscribe((async()=>{try{await analytics_service_AnalyticsService.recordAuthTypeAnalytics(e)}catch{}}))}stop(){this.securityFeaturesSubscription&&(this.securityFeaturesSubscription.unsubscribe(),this.securityFeaturesSubscription=void 0)}static async recordAuthTypeAnalytics(e){localStorage.setItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey,JSON.stringify(await e.post("/internal/security/analytics/_record_auth_type",{body:localStorage.getItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey)})))}}s()(analytics_service_AnalyticsService,"AuthTypeInfoStorageKey","kibana.security.userAuthType");const S=Object.freeze({isEnabled:!1,accessURLParameters:null});class anonymous_access_service_AnonymousAccessService{constructor(){s()(this,"internalService",void 0)}setup({share:e}){e.setAnonymousAccessServiceProvider((()=>this.internalService))}start({http:e}){this.internalService={getCapabilities:()=>e.get("/internal/security/anonymous_access/capabilities"),getState:()=>e.anonymousPaths.isAnonymous(window.location.pathname)?Promise.resolve(S):e.get("/internal/security/anonymous_access/state").catch((()=>S))}}}const x=Object.freeze({id:"security_access_agreement",create({application:e,getStartServices:t}){e.register({id:this.id,title:r.i18n.translate("xpack.security.accessAgreementAppTitle",{defaultMessage:"Access Agreement"}),chromeless:!0,appRoute:"/security/access_agreement",async mount({element:e,theme$:n}){const[[s],{renderAccessAgreementPage:r}]=await Promise.all([t(),Promise.all([i.e(0),i.e(1),i.e(2),i.e(10)]).then(i.bind(null,282))]);return r(s.i18n,{element:e,theme$:n},{http:s.http,notifications:s.notifications,fatalErrors:s.fatalErrors})}})}});var O=i(10);const w=Object.freeze({id:"security_capture_url",create({application:e,fatalErrors:t,http:n}){n.anonymousPaths.register("/internal/security/capture-url"),e.register({id:this.id,title:"Capture URL",chromeless:!0,appRoute:"/internal/security/capture-url",async mount(){try{const{parseNext:e}=await i.e(0).then(i.bind(null,88)),t=new URL(e(window.location.href,n.basePath.serverBasePath),window.location.origin);t.searchParams.append(O.c,window.location.hash),window.location.replace(t.toString())}catch(e){t.add(new Error(`Cannot parse current URL: ${e&&e.message}.`))}return()=>{}}})}}),A=Object.freeze({id:"security_logged_out",create({application:e,http:t,getStartServices:n}){t.anonymousPaths.register("/security/logged_out"),e.register({id:this.id,title:r.i18n.translate("xpack.security.loggedOutAppTitle",{defaultMessage:"Logged out"}),chromeless:!0,appRoute:"/security/logged_out",async mount({element:e,theme$:t}){const[[s],{renderLoggedOutPage:r}]=await Promise.all([n(),Promise.all([i.e(0),i.e(1),i.e(15)]).then(i.bind(null,283))]);return r(s.i18n,{element:e,theme$:t},{basePath:s.http.basePath,customBranding:s.customBranding})}})}}),P=Object.freeze({id:"security_login",create({application:e,http:t,getStartServices:n,config:s}){t.anonymousPaths.register("/login"),e.register({id:this.id,title:r.i18n.translate("xpack.security.loginAppTitle",{defaultMessage:"Login"}),chromeless:!0,appRoute:"/login",async mount({element:e,theme$:t}){const[[r],{renderLoginPage:o}]=await Promise.all([n(),Promise.all([i.e(2),i.e(7)]).then(i.bind(null,294))]);return o(r.i18n,{element:e,theme$:t},{customBranding:r.customBranding,http:r.http,notifications:r.notifications,fatalErrors:r.fatalErrors,loginAssistanceMessage:s.loginAssistanceMessage,sameSiteCookies:s.sameSiteCookies})}})}}),C=Object.freeze({id:"security_logout",create({application:e,http:t}){t.anonymousPaths.register("/logout"),e.register({id:this.id,title:r.i18n.translate("xpack.security.logoutAppTitle",{defaultMessage:"Logout"}),chromeless:!0,appRoute:"/logout",mount:async()=>(window.sessionStorage.clear(),window.localStorage.removeItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey),window.location.href=t.basePath.prepend(`/api/security/logout${window.location.search}`),()=>{})})}}),k=Object.freeze({id:"security_overwritten_session",create({application:e,authc:t,getStartServices:n}){e.register({id:this.id,title:r.i18n.translate("xpack.security.overwrittenSessionAppTitle",{defaultMessage:"Overwritten Session"}),chromeless:!0,appRoute:"/security/overwritten_session",async mount({element:e,theme$:s}){const[[r],{renderOverwrittenSessionPage:o}]=await Promise.all([n(),Promise.all([i.e(0),i.e(1),i.e(16)]).then(i.bind(null,284))]);return o(r.i18n,{element:e,theme$:s},{authc:t,basePath:r.http.basePath})}})}});class authentication_service_AuthenticationService{setup({application:e,fatalErrors:t,config:i,getStartServices:n,http:s}){const r=async()=>await s.get("/internal/security/me",{asSystemRequest:!0});return x.create({application:e,getStartServices:n}),w.create({application:e,fatalErrors:t,http:s}),P.create({application:e,config:i,getStartServices:n,http:s}),C.create({application:e,http:s}),A.create({application:e,getStartServices:n,http:s}),k.create({application:e,authc:{getCurrentUser:r},getStartServices:n}),{getCurrentUser:r,areAPIKeysEnabled:async()=>(await s.get("/internal/security/api_key/_enabled")).apiKeysEnabled}}}var I=i(15),E=i(17);const T=Object.freeze({id:"api_keys",create({authc:e,getStartServices:t}){return{id:this.id,order:30,title:r.i18n.translate("xpack.security.management.apiKeysTitle",{defaultMessage:"API keys"}),async mount({element:n,theme$:s,setBreadcrumbs:o,history:a}){const[[c],{APIKeysGridPage:l},{APIKeysAPIClient:h}]=await Promise.all([t(),i.e(4).then(i.bind(null,291)),i.e(17).then(i.bind(null,109))]);return Object(u.render)(Object(m.jsx)(M,{services:c,theme$:s,history:a,authc:e,onChange:Object(g.c)(c.chrome,o)},Object(m.jsx)(g.a,{text:r.i18n.translate("xpack.security.management.apiKeysTitle",{defaultMessage:"API keys"}),href:"/"},Object(m.jsx)(l,{history:a,notifications:c.notifications,apiKeysAPIClient:new h(c.http),readOnly:!c.application.capabilities.api_keys.save}))),n),()=>{Object(u.unmountComponentAtNode)(n)}}}}}),M=({services:e,theme$:t,history:i,authc:n,onChange:s,children:o})=>Object(m.jsx)(b.KibanaContextProvider,{services:e},Object(m.jsx)(I.a,{authc:n},Object(m.jsx)(p.I18nProvider,null,Object(m.jsx)(b.KibanaThemeProvider,{theme$:t},Object(m.jsx)(h.Router,{history:i},Object(m.jsx)(E.a,{featureId:"api_keys",tooltip:r.i18n.translate("xpack.security.management.api_keys.readonlyTooltip",{defaultMessage:"Unable to create or edit API keys"})}),Object(m.jsx)(g.b,{onChange:s},o))))));var R=i(18);const L=Object.freeze({id:"role_mappings",create({getStartServices:e}){const t=r.i18n.translate("xpack.security.management.roleMappingsTitle",{defaultMessage:"Role Mappings"});return{id:this.id,order:40,title:t,async mount({element:n,theme$:s,setBreadcrumbs:o,history:a}){const[[c],{RoleMappingsGridPage:l},{EditRoleMappingPage:d},{RoleMappingsAPIClient:p},{RolesAPIClient:f}]=await Promise.all([e(),i.e(11).then(i.bind(null,295)),i.e(8).then(i.bind(null,292)),i.e(18).then(i.bind(null,285)),Promise.resolve().then(i.bind(null,28))]);c.chrome.docTitle.change(t);const v=new p(c.http),y=({action:e})=>{const{name:t}=Object(h.useParams)(),i=t?Object(R.a)(t):void 0,n="edit"===e&&t&&i?{text:i,href:`/edit/${encodeURIComponent(t)}`}:{text:r.i18n.translate("xpack.security.roleMappings.createBreadcrumb",{defaultMessage:"Create"})};return Object(m.jsx)(g.a,{text:n.text,href:n.href},Object(m.jsx)(d,{action:e,name:i,roleMappingsAPI:v,rolesAPIClient:new f(c.http),notifications:c.notifications,docLinks:c.docLinks,history:a,readOnly:!c.application.capabilities.role_mappings.save}))};return Object(u.render)(Object(m.jsx)(b.KibanaContextProvider,{services:c},Object(m.jsx)(c.i18n.Context,null,Object(m.jsx)(b.KibanaThemeProvider,{theme$:s},Object(m.jsx)(h.Router,{history:a},Object(m.jsx)(E.a,{"data-test-subj":"readOnlyBadge",featureId:"role_mappings",tooltip:r.i18n.translate("xpack.security.management.roleMappings.readonlyTooltip",{defaultMessage:"Unable to create or edit role mappings"})}),Object(m.jsx)(g.b,{onChange:Object(g.c)(c.chrome,o)},Object(m.jsx)(g.a,{text:t,href:"/"},Object(m.jsx)(h.Route,{path:["/",""],exact:!0},Object(m.jsx)(l,{notifications:c.notifications,rolesAPIClient:new f(c.http),roleMappingsAPI:v,docLinks:c.docLinks,history:a,navigateToApp:c.application.navigateToApp,readOnly:!c.application.capabilities.role_mappings.save})),Object(m.jsx)(h.Route,{path:"/edit/:name?"},Object(m.jsx)(y,{action:"edit"})),Object(m.jsx)(h.Route,{path:"/clone/:name"},Object(m.jsx)(y,{action:"clone"})))))))),n),()=>{Object(u.unmountComponentAtNode)(n)}}}}});var U=i(28),$=i(20);class management_service_ManagementService{constructor(){s()(this,"license",void 0),s()(this,"licenseFeaturesSubscription",void 0),s()(this,"securitySection",void 0)}setup({getStartServices:e,management:t,authc:i,license:n,fatalErrors:s}){this.license=n,this.securitySection=t.sections.section.security,this.securitySection.registerApp($.usersManagementApp.create({authc:i,getStartServices:e})),this.securitySection.registerApp(U.rolesManagementApp.create({fatalErrors:s,license:n,getStartServices:e})),this.securitySection.registerApp(T.create({authc:i,getStartServices:e})),this.securitySection.registerApp(L.create({getStartServices:e}))}start({capabilities:e}){this.licenseFeaturesSubscription=this.license.features$.subscribe((async t=>{const i=this.securitySection,n=[[i.getApp($.usersManagementApp.id),t.showLinks],[i.getApp(U.rolesManagementApp.id),t.showLinks],[i.getApp(T.id),t.showLinks],[i.getApp(L.id),t.showLinks&&t.showRoleMappingsManagement]];for(const[t,i]of n)!0===e.management.security[t.id]?t.enabled!==i&&(i?t.enable():t.disable()):t.disable()}))}stop(){this.licenseFeaturesSubscription&&(this.licenseFeaturesSubscription.unsubscribe(),this.licenseFeaturesSubscription=void 0)}}var B=i(22),D=i(21),F=i(32),z=i(2),N=i(16),K=i.n(N),V=i(27),H=i(19);const W=({editProfileUrl:e,logoutUrl:t,userMenuLinks$:i})=>{const n=K()(i,[]),[s,o]=Object(a.useState)(!1),c=Object(f.e)("avatar"),u=Object(f.c)(),l=u.value?Object(H.h)(u.value):"",h=Object(m.jsx)(z.EuiHeaderSectionItemButton,{"aria-controls":"headerUserMenu","aria-expanded":s,"aria-haspopup":"true","aria-label":r.i18n.translate("xpack.security.navControlComponent.accountMenuAriaLabel",{defaultMessage:"Account menu"}),onClick:()=>o((e=>!!u.value&&!e)),"data-test-subj":"userMenuButton",style:{lineHeight:"normal"}},c.value?Object(m.jsx)(V.a,{user:c.value.user,avatar:c.value.data.avatar,size:"s","data-test-subj":"userMenuAvatar"}):u.value&&c.error?Object(m.jsx)(V.a,{user:u.value,size:"s","data-test-subj":"userMenuAvatar"}):Object(m.jsx)(z.EuiLoadingSpinner,{size:"m"})),d=[];if(n.length){const e=n.sort((({order:e=1/0},{order:t=1/0})=>e-t)).map((({label:e,iconType:t,href:i})=>({name:e,icon:Object(m.jsx)(z.EuiIcon,{type:t,size:"m"}),href:i,"data-test-subj":`userMenuLink__${e}`})));d.push(...e)}const b=!!u.value&&Object(H.o)(u.value),g=n.some((({setAsProfile:e})=>!0===e));if(!b&&!g){const t={name:Object(m.jsx)(p.FormattedMessage,{id:"xpack.security.navControlComponent.editProfileLinkText",defaultMessage:"Edit profile"}),icon:Object(m.jsx)(z.EuiIcon,{type:"user",size:"m"}),href:e,onClick:()=>{o(!1)},"data-test-subj":"profileLink"};d.unshift(t)}return d.push({name:b?Object(m.jsx)(p.FormattedMessage,{id:"xpack.security.navControlComponent.loginLinkText",defaultMessage:"Log in"}):Object(m.jsx)(p.FormattedMessage,{id:"xpack.security.navControlComponent.logoutLinkText",defaultMessage:"Log out"}),icon:Object(m.jsx)(z.EuiIcon,{type:"exit",size:"m"}),href:t,"data-test-subj":"logoutLink"}),Object(m.jsx)(z.EuiPopover,{id:"headerUserMenu",ownFocus:!0,button:h,isOpen:s,anchorPosition:"downRight",repositionOnScroll:!0,closePopover:()=>o(!1),panelPaddingSize:"none",buffer:0},Object(m.jsx)("div",{"data-test-subj":"userMenu"},Object(m.jsx)(z.EuiContextMenu,{className:"chrNavControl__userMenu",initialPanelId:0,panels:[{id:0,title:l,items:d}]})))};class nav_control_service_SecurityNavControlService{constructor(){s()(this,"securityLicense",void 0),s()(this,"logoutUrl",void 0),s()(this,"securityApiClients",void 0),s()(this,"navControlRegistered",void 0),s()(this,"securityFeaturesSubscription",void 0),s()(this,"stop$",new j.ReplaySubject(1)),s()(this,"userMenuLinks$",new j.BehaviorSubject([]))}setup({securityLicense:e,logoutUrl:t,securityApiClients:i}){this.securityLicense=e,this.logoutUrl=t,this.securityApiClients=i}start({core:e,authc:t}){return this.securityFeaturesSubscription=this.securityLicense.features$.subscribe((({showLinks:i})=>{!e.http.anonymousPaths.isAnonymous(window.location.pathname)&&i&&!this.navControlRegistered&&this.registerSecurityNavControl(e,t)})),{getUserMenuLinks$:()=>this.userMenuLinks$.pipe(Object(o.map)(this.sortUserMenuLinks),Object(o.takeUntil)(this.stop$)),addUserMenuLinks:e=>{const t=this.userMenuLinks$.value,i=t.find((({setAsProfile:e})=>!0===e)),n=e.filter((({setAsProfile:e})=>!0===e)).length;if(i&&n>0)throw new Error(`Only one custom profile link can be set. A custom profile link named ${i.label} (${i.href}) already exists`);if(n>1)throw new Error(`Only one custom profile link can be passed at a time (found ${n})`);const s=[...t,...e];this.userMenuLinks$.next(s)}}}stop(){this.securityFeaturesSubscription&&(this.securityFeaturesSubscription.unsubscribe(),this.securityFeaturesSubscription=void 0),this.navControlRegistered=!1,this.stop$.next()}registerSecurityNavControl(e,t){const{theme$:i}=e.theme;e.chrome.navControls.registerRight({order:2e3,mount:n=>(l.a.render(Object(m.jsx)(q,{services:e,authc:t,theme$:i,securityApiClients:this.securityApiClients},Object(m.jsx)(W,{editProfileUrl:e.http.basePath.prepend("/security/account"),logoutUrl:this.logoutUrl,userMenuLinks$:this.userMenuLinks$})),n),()=>l.a.unmountComponentAtNode(n))}),this.navControlRegistered=!0}sortUserMenuLinks(e){return Object(D.sortBy)(e,"order")}}const q=({authc:e,services:t,theme$:i,securityApiClients:n,children:s})=>Object(m.jsx)(b.KibanaContextProvider,{services:t},Object(m.jsx)(f.a,{authc:e},Object(m.jsx)(f.b,n,Object(m.jsx)(p.I18nProvider,null,Object(m.jsx)(b.KibanaThemeProvider,{theme$:i},Object(m.jsx)(F.a,{coreStart:t},s)))))),G=r.i18n.translate("xpack.security.checkup.insecureClusterTitle",{defaultMessage:"Your data is not secure"}),J=(e,t)=>i=>(Object(u.render)(Object(m.jsx)((()=>{const[i,n]=Object(a.useState)(!1),s=`${e.links.security.elasticsearchEnableSecurity}?blade=kibanasecuritymessage`;return Object(m.jsx)(p.I18nProvider,null,Object(m.jsx)("div",{"data-test-subj":"insecureClusterAlertText"},Object(m.jsx)(z.EuiText,{size:"s"},Object(m.jsx)(p.FormattedMessage,{id:"xpack.security.checkup.insecureClusterMessage",defaultMessage:"Donâ€™t lose one bit. Enable our free security features."})),Object(m.jsx)(z.EuiSpacer,null),Object(m.jsx)(z.EuiCheckbox,{id:"persistDismissedAlertPreference",checked:i,onChange:e=>n(e.target.checked),label:r.i18n.translate("xpack.security.checkup.dontShowAgain",{defaultMessage:"Don't show again"})}),Object(m.jsx)(z.EuiSpacer,null),Object(m.jsx)(z.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(m.jsx)(z.EuiFlexItem,{grow:!1},Object(m.jsx)(z.EuiButton,{size:"s",color:"primary",fill:!0,href:s,target:"_blank","data-test-subj":"learnMoreButton"},r.i18n.translate("xpack.security.checkup.enableButtonText",{defaultMessage:"Enable security"}))),Object(m.jsx)(z.EuiFlexItem,{grow:!1},Object(m.jsx)(z.EuiButton,{size:"s",onClick:()=>t(i),"data-test-subj":"dismissAlertButton"},r.i18n.translate("xpack.security.checkup.dismissButtonText",{defaultMessage:"Dismiss"}))))))}),null),i),()=>Object(u.unmountComponentAtNode)(i)),Z=Object.freeze({displayAlert:!1});class security_checkup_service_SecurityCheckupService{constructor(e,t){s()(this,"enabled",void 0),s()(this,"alertVisibility$",void 0),s()(this,"storage",void 0),s()(this,"alertToast",void 0),s()(this,"storageKey",void 0),this.storage=t,this.enabled=e.showInsecureClusterWarning,this.alertVisibility$=new j.BehaviorSubject(this.enabled)}setup({http:e}){const t=e.basePath.serverBasePath;this.storageKey=`insecureClusterWarningVisibility${t}`,this.enabled=this.enabled&&this.getPersistedVisibilityPreference(),this.alertVisibility$.next(this.enabled)}start(e){this.enabled&&this.initializeAlert(e)}initializeAlert({http:e,notifications:t,docLinks:i}){const n=Object(j.from)(this.getSecurityCheckupState(e));Object(j.combineLatest)([n,this.alertVisibility$]).pipe(Object(o.map)((([{displayAlert:e},t])=>e&&t)),Object(o.distinctUntilChanged)()).subscribe((e=>{e&&!this.alertToast?this.alertToast=t.toasts.addWarning({title:G,text:J(i,(e=>this.setAlertVisibility(!1,e))),iconType:"alert"},{toastLifeTimeMs:864e6}):!e&&this.alertToast&&(t.toasts.remove(this.alertToast),this.alertToast=void 0)}))}getSecurityCheckupState(e){return e.anonymousPaths.isAnonymous(window.location.pathname)?Promise.resolve(Z):e.get("/internal/security/security_checkup/state").catch((()=>Z))}setAlertVisibility(e,t){this.enabled&&(this.alertVisibility$.next(e),t&&this.setPersistedVisibilityPreference(e))}getPersistedVisibilityPreference(){var e;const t=null!==(e=this.storage.getItem(this.storageKey))&&void 0!==e?e:"{}";try{const{show:e=!0}=JSON.parse(t);return e}catch(e){return!0}}setPersistedVisibilityPreference(e){this.storage.setItem(this.storageKey,JSON.stringify({show:e}))}}class session_expired_SessionExpired{constructor(e,t,i){this.application=e,this.logoutUrl=t,this.tenant=i}logout(e){const t=(()=>{const{location:e}=window,t=encodeURIComponent(`${e.pathname}${e.search}${e.hash}`);return`&${O.h}=${t}`})(),i=(e=>{const t=`${this.tenant}/session_provider`,i=sessionStorage.getItem(t);return i?`&${O.d}=${encodeURIComponent(i)}`:""})();this.application.navigateToUrl(`${this.logoutUrl}?${O.e}=${e}${t}${i}`,{forceRedirect:!0,skipAppLeave:!0})}}let X;!function(e){e.SESSION_EXPIRED="SESSION_EXPIRED",e.AUTHENTICATION_ERROR="AUTHENTICATION_ERROR",e.LOGGED_OUT="LOGGED_OUT",e.UNAUTHENTICATED="UNAUTHENTICATED"}(X||(X={}));var Y=i(25),Q=i.n(Y);const ee=({sessionState$:e,onExtend:t})=>{const i=K()(e),[{loading:n},s]=Q()(t);if(!i||!i.expiresInMs)return null;const r=Object(m.jsx)(p.FormattedMessage,{id:"xpack.security.sessionExpirationToast.body",defaultMessage:"You will be logged out {timeout}.",values:{timeout:Object(m.jsx)(p.FormattedRelative,{value:Math.max(i.expiresInMs-O.m,0)+Date.now(),updateInterval:1e3})}});return i.canBeExtended?Object(m.jsx)(c.a.Fragment,null,r,Object(m.jsx)(z.EuiSpacer,{size:"m"}),Object(m.jsx)(z.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(m.jsx)(z.EuiFlexItem,{grow:!1},Object(m.jsx)(z.EuiButton,{size:"s",color:"warning",isLoading:n,onClick:s},Object(m.jsx)(p.FormattedMessage,{id:"xpack.security.sessionExpirationToast.extendButton",defaultMessage:"Stay logged in"}))))):r};class session_timeout_SessionTimeout{constructor(e,t,i,n){s()(this,"channel",void 0),s()(this,"isVisible","hidden"!==document.visibilityState),s()(this,"isFetchingSessionInfo",!1),s()(this,"consecutiveErrorCount",0),s()(this,"snoozedWarningState",void 0),s()(this,"sessionState$",new j.BehaviorSubject({lastExtensionTime:0,expiresInMs:null,canBeExtended:!1})),s()(this,"subscription",void 0),s()(this,"warningToast",void 0),s()(this,"stopActivityMonitor",void 0),s()(this,"stopVisibilityMonitor",void 0),s()(this,"removeHttpInterceptor",void 0),s()(this,"stopRefreshTimer",void 0),s()(this,"stopWarningTimer",void 0),s()(this,"stopLogoutTimer",void 0),s()(this,"handleChannelMessage",(e=>{this.isSessionState(e.data)&&this.sessionState$.next(e.data)})),s()(this,"isSessionState",(e=>"object"==typeof e&&Object.hasOwn(null!=e?e:{},"canBeExtended"))),s()(this,"handleHttpRequest",(e=>{if(-1===e.path.indexOf("://")&&!e.path.startsWith("//"))return e.asSystemRequest?void 0:{...e,asSystemRequest:!this.isVisible}})),s()(this,"handleUserActivity",(()=>{this.shouldExtend()&&this.fetchSessionInfo(!0)})),s()(this,"handleVisibilityChange",(e=>{this.isVisible=e,e&&this.handleUserActivity()})),s()(this,"resetTimers",(({lastExtensionTime:e,expiresInMs:t})=>{var i,n,s;if(this.stopRefreshTimer=null===(i=this.stopRefreshTimer)||void 0===i?void 0:i.call(this),this.stopWarningTimer=null===(n=this.stopWarningTimer)||void 0===n?void 0:n.call(this),this.stopLogoutTimer=null===(s=this.stopLogoutTimer)||void 0===s?void 0:s.call(this),null!==t){const i=Math.max(t-O.m,0),n=Math.max(i-O.k,this.snoozedWarningState?this.snoozedWarningState.lastExtensionTime+this.snoozedWarningState.expiresInMs-O.m-e:0,0),s=n-O.i;this.stopLogoutTimer=te((()=>this.sessionExpired.logout(X.SESSION_EXPIRED)),i),n>0&&this.hideWarning(),n<i&&(this.stopWarningTimer=te(this.showWarning,n)),s>0&&s<i&&(this.stopRefreshTimer=te(this.fetchSessionInfo,s))}})),s()(this,"toggleEventHandlers",(({expiresInMs:e,canBeExtended:t})=>{var i,n,s;null!==e?(t&&!this.stopActivityMonitor&&(this.stopActivityMonitor=function(e){const t=["mousemove","mousedown","wheel","touchstart","keydown"];for(const i of t)window.addEventListener(i,e);return()=>{for(const i of t)window.removeEventListener(i,e)}}(this.handleUserActivity)),this.removeHttpInterceptor||(this.removeHttpInterceptor=this.http.intercept({request:this.handleHttpRequest})),this.stopVisibilityMonitor||(this.stopVisibilityMonitor=function(e){const t=()=>e("hidden"!==document.visibilityState);return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}(this.handleVisibilityChange))):(this.removeHttpInterceptor=null===(i=this.removeHttpInterceptor)||void 0===i?void 0:i.call(this),this.stopActivityMonitor=null===(n=this.stopActivityMonitor)||void 0===n?void 0:n.call(this),this.stopVisibilityMonitor=null===(s=this.stopVisibilityMonitor)||void 0===s?void 0:s.call(this))})),s()(this,"fetchSessionInfo",(async(e=!1)=>{this.isFetchingSessionInfo=!0;try{const t=await this.http.fetch(O.n,{method:e?"POST":"GET",asSystemRequest:!e});if(this.consecutiveErrorCount=0,t){const{expiresInMs:e,canBeExtended:i}=t,n={lastExtensionTime:Date.now(),expiresInMs:e,canBeExtended:i};return this.sessionState$.next(n),this.channel&&this.channel.postMessage(n),n}}catch(e){this.consecutiveErrorCount++}finally{this.isFetchingSessionInfo=!1}})),s()(this,"showWarning",(()=>{if(!this.warningToast){const e=async()=>{const{canBeExtended:e}=this.sessionState$.getValue();e&&await this.fetchSessionInfo(!0)},t=()=>(this.hideWarning(!0),e()),i=((e,t,i)=>({color:"warning",iconType:"clock",title:r.i18n.translate("xpack.security.sessionExpirationToast.title",{defaultMessage:"Session timeout"}),text:Object(b.toMountPoint)(Object(m.jsx)(ee,{sessionState$:e,onExtend:t})),onClose:i,toastLifeTimeMs:2147483647}))(this.sessionState$,e,t);this.warningToast=this.notifications.toasts.add(i)}})),s()(this,"hideWarning",((e=!1)=>{this.warningToast&&(this.notifications.toasts.remove(this.warningToast),this.warningToast=void 0,e&&(this.snoozedWarningState=this.sessionState$.getValue()))})),this.notifications=e,this.sessionExpired=t,this.http=i,this.tenant=n}async start(){if(!this.http.anonymousPaths.isAnonymous(window.location.pathname)){this.subscription=this.sessionState$.pipe(Object(o.skip)(1),Object(o.throttleTime)(1e3),Object(o.tap)(this.toggleEventHandlers)).subscribe(this.resetTimers);try{this.channel=new BroadcastChannel(`${this.tenant}/session_timeout`),this.channel.onmessage=e=>this.handleChannelMessage(e)}catch(e){console.warn("Failed to load broadcast channel. Session management will not be kept in sync when multiple tabs are loaded.",e)}return this.fetchSessionInfo()}}stop(){var e,t;const i={lastExtensionTime:0,expiresInMs:null,canBeExtended:!1};this.toggleEventHandlers(i),this.resetTimers(i),null===(e=this.subscription)||void 0===e||e.unsubscribe(),null===(t=this.channel)||void 0===t||t.close()}shouldExtend(){const{lastExtensionTime:e}=this.sessionState$.getValue();return!this.isFetchingSessionInfo&&!this.warningToast&&Date.now()>e+O.l*Math.exp(this.consecutiveErrorCount)}}function te(e,t,i){var n;const s=2147483647;let r;return(i=null!==(n=i)&&void 0!==n?n:e=>r=e)(t>s?window.setTimeout((()=>te(e,t-s,i)),s):window.setTimeout(e,t)),()=>clearTimeout(r)}class unauthorized_response_http_interceptor_UnauthorizedResponseHttpInterceptor{constructor(e,t){this.sessionExpired=e,this.anonymousPaths=t}responseError(e,t){if(this.anonymousPaths.isAnonymous(window.location.pathname))return;if("omit"===e.request.credentials)return;const{response:i}=e;if(i&&401===i.status){const e=i.headers.get(O.j);this.sessionExpired.logout(e===X.SESSION_EXPIRED?X.SESSION_EXPIRED:X.AUTHENTICATION_ERROR),t.halt()}}}var ie=i(12),ne=i.n(ie);class suspense_error_boundary_SuspenseErrorBoundary extends a.Component{constructor(...e){super(...e),s()(this,"state",{error:null})}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){const{notifications:t}=this.props;if(t){const i=r.i18n.translate("xpack.security.uiApi.errorBoundaryToastTitle",{defaultMessage:"Failed to load Kibana asset"}),n=r.i18n.translate("xpack.security.uiApi.errorBoundaryToastMessage",{defaultMessage:"Reload page to continue."});t.toasts.addError(e,{title:i,toastMessage:n})}}render(){const{children:e,notifications:t}=this.props,{error:i}=this.state;return!t||i?null:Object(m.jsx)(a.Suspense,{fallback:Object(m.jsx)(z.EuiLoadingSpinner,null)},e)}}const se=({fn:e,core:t,props:i})=>{const{notifications:n}=t,s=Object(a.useMemo)((()=>Object(a.lazy)((()=>e().then((e=>({default:e})))))),[e]);return n?Object(m.jsx)(suspense_error_boundary_SuspenseErrorBoundary,{notifications:n},Object(m.jsx)(s,i)):null},re=async()=>{const{PersonalInfo:e}=await i.e(21).then(i.bind(null,289));return t=>Object(m.jsx)(e,t)},oe=({core:e})=>{function t(t){return i=>Object(m.jsx)(se,{fn:t,core:e,props:i})}return{getPersonalInfo:t(re),getChangePassword:t((()=>(async e=>{const{ChangePassword:t}=await i.e(14).then(i.bind(null,288));return i=>Object(m.jsx)(t,ne()({notifications:e.notifications,userAPIClient:new $.UserAPIClient(e.http)},i))})(e)))}},ae=({core:e})=>({components:oe({core:e})});class plugin_SecurityPlugin{constructor(e){s()(this,"config",void 0),s()(this,"sessionTimeout",void 0),s()(this,"authenticationService",new authentication_service_AuthenticationService),s()(this,"navControlService",new nav_control_service_SecurityNavControlService),s()(this,"securityLicenseService",new license_service_SecurityLicenseService),s()(this,"managementService",new management_service_ManagementService),s()(this,"securityCheckupService",void 0),s()(this,"anonymousAccessService",new anonymous_access_service_AnonymousAccessService),s()(this,"analyticsService",new analytics_service_AnalyticsService),s()(this,"authc",void 0),s()(this,"securityApiClients",void 0),this.initializerContext=e,this.config=this.initializerContext.config.get(),this.securityCheckupService=new security_checkup_service_SecurityCheckupService(this.config,localStorage)}setup(e,{cloud:t,home:i,licensing:n,management:s,share:o}){const{license:a}=this.securityLicenseService.setup({license$:n.license$});return this.securityCheckupService.setup({http:e.http}),this.authc=this.authenticationService.setup({application:e.application,fatalErrors:e.fatalErrors,config:this.config,getStartServices:e.getStartServices,http:e.http}),this.securityApiClients={userProfiles:new user_profile_api_client_UserProfileAPIClient(e.http),users:new B.UserAPIClient(e.http)},this.navControlService.setup({securityLicense:a,logoutUrl:ce(e.http),securityApiClients:this.securityApiClients}),this.analyticsService.setup({analytics:e.analytics,authc:this.authc,cloudId:null==t?void 0:t.cloudId,http:e.http,securityLicense:a}),v.create({authc:this.authc,application:e.application,getStartServices:e.getStartServices,securityApiClients:this.securityApiClients}),s&&this.managementService.setup({license:a,management:s,authc:this.authc,fatalErrors:e.fatalErrors,getStartServices:e.getStartServices}),s&&i&&i.featureCatalogue.register({id:"security",title:r.i18n.translate("xpack.security.registerFeature.securitySettingsTitle",{defaultMessage:"Manage permissions"}),description:r.i18n.translate("xpack.security.registerFeature.securitySettingsDescription",{defaultMessage:"Control who has access and what tasks they can perform."}),icon:"securityApp",path:"/app/management/security/roles",showOnHomePage:!0,category:"admin",order:600}),o&&this.anonymousAccessService.setup({share:o}),{authc:this.authc,license:a}}start(e,{management:t,share:i}){const{application:n,http:s,notifications:r,docLinks:o}=e,{anonymousPaths:a}=s,c=ce(s),u=s.basePath.serverBasePath,l=new session_expired_SessionExpired(n,c,u);return s.intercept(new unauthorized_response_http_interceptor_UnauthorizedResponseHttpInterceptor(l,a)),this.sessionTimeout=new session_timeout_SessionTimeout(r,l,s,u),this.sessionTimeout.start(),this.securityCheckupService.start({http:s,notifications:r,docLinks:o}),t&&this.managementService.start({capabilities:n.capabilities}),i&&this.anonymousAccessService.start({http:s}),this.analyticsService.start({http:e.http}),{uiApi:ae({core:e}),navControlService:this.navControlService.start({core:e,authc:this.authc}),authc:this.authc,userProfiles:{getCurrent:this.securityApiClients.userProfiles.getCurrent.bind(this.securityApiClients.userProfiles),bulkGet:this.securityApiClients.userProfiles.bulkGet.bind(this.securityApiClients.userProfiles),suggest:this.securityApiClients.userProfiles.suggest.bind(this.securityApiClients.userProfiles)}}}stop(){var e;null===(e=this.sessionTimeout)||void 0===e||e.stop(),this.navControlService.stop(),this.securityLicenseService.stop(),this.managementService.stop(),this.analyticsService.stop()}}function ce(e){return`${e.basePath.serverBasePath}/logout`}const ue=e=>new plugin_SecurityPlugin(e)},function(e,t){e.exports=__kbnSharedDeps__.Classnames},function(e,t){e.exports=__kbnSharedDeps__.KbnUiTheme},function(e,t){e.exports=__kbnSharedDeps__.SaferLodashSet},function(e,t){e.exports=__kbnSharedDeps__.MomentTimezone},function(e,t){e.exports=__kbnSharedDeps__.EmotionCache},function(e,t,i){i.r(t);var n=__kbnBundles__.get("plugin/features/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,i){i.r(t);var n=__kbnBundles__.get("plugin/spaces/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,i){i.r(t);var n=__kbnBundles__.get("plugin/esUiShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.KbnMonaco},function(e,t,i){i.r(t);var n=__kbnBundles__.get("plugin/spaces/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.KbnStd}]);