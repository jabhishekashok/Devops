/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[34],{121:function(e,t,s){"use strict";s.r(t),s.d(t,"AlertsTableState",(function(){return R})),s.d(t,"default",(function(){return R}));var l=s(1),n=s.n(l),o=s(19),i=s(3),a=s(57),r=s(20),u=s(166),c=s(279),d=s(132),b=s(23),g=s(246),j=s.n(g),p=s(160),m=s(0);const f={tall:490,short:250},C={maxWidth:500},O=({height:e="tall",controls:t,getInspectQuery:s,showInpectButton:l})=>Object(m.jsx)(i.EuiPanel,{color:"subdued","data-test-subj":"alertsStateTableEmptyState"},Object(m.jsx)(i.EuiFlexGroup,{alignItems:"flexEnd",justifyContent:"flexEnd"},l&&Object(m.jsx)(i.EuiFlexItem,{grow:!1},Object(m.jsx)(p.a,{getInspectQuery:s})),(null==t?void 0:t.right)&&Object(m.jsx)(i.EuiFlexItem,{grow:!1},t.right)),Object(m.jsx)(i.EuiFlexGroup,{style:{height:f[e]},alignItems:"center",justifyContent:"center"},Object(m.jsx)(i.EuiFlexItem,{grow:!1},Object(m.jsx)(i.EuiPanel,{hasBorder:!0,style:C},Object(m.jsx)(i.EuiFlexGroup,null,Object(m.jsx)(i.EuiFlexItem,null,Object(m.jsx)(i.EuiText,{size:"s"},Object(m.jsx)(i.EuiTitle,null,Object(m.jsx)("h3",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.triggersActionsUI.empty.title",defaultMessage:"No results match your search criteria"}))),Object(m.jsx)("p",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.triggersActionsUI.empty.description",defaultMessage:"Try searching over a longer period of time or modifying your search"})))),Object(m.jsx)(i.EuiFlexItem,{grow:!1},Object(m.jsx)(i.EuiImage,{style:{width:200,height:148},size:"200",alt:"",url:j.a})))))));var x=s(178),w=s(18);const h=e=>new Map(Array.from(Array(e).keys()).map((e=>[e,{isLoading:!1}]))),v=(e,{action:t,rowIndex:s,rowCount:l,isLoading:n=!1})=>{const{rowSelection:o,rowCount:i}=e,a={...e};if(t===w.g.add&&void 0!==s){const e=new Map(o);e.set(s,{isLoading:n}),a.rowSelection=e}else if(t===w.g.delete&&void 0!==s){const e=new Map(o);e.delete(s),a.rowSelection=e}else if(t===w.g.selectCurrentPage)a.rowSelection=h(i);else if(t===w.g.selectAll)a.rowSelection=h(i),a.isAllSelected=!0;else if(t===w.g.clear)a.rowSelection=new Map,a.isAllSelected=!1;else if(t===w.g.rowCountUpdate&&void 0!==l)a.rowCount=l;else if(t===w.g.updateAllLoadingState){const e=new Map(Array.from(o.keys()).map((e=>[e,{isLoading:n}])));a.rowSelection=e}else t===w.g.updateRowLoadingState&&void 0!==s&&a.rowSelection.set(s,{isLoading:n});return a.areAllVisibleRowsSelected=a.rowSelection.size===a.rowCount,a};var S=s(187),y=s(25),I=s(176);const A=(e,t,s)=>{return{...k(s,e)||{id:e},schema:(l=E(e,t).type,"date"===l?"datetime":"number"===l?"numeric":"object"===l?"json":l)};var l},E=(e,t)=>{const s={type:"string"};if(!t||0===Object.keys(t).length)return s;const l=(e=>{const t=e.split(".");return 1===t.length?"base":t[0]})(e);if(!t[l])return s;const n=t[l].fields;if(!n)return s;return n[e]||s},F=(e,t,s)=>e.map((e=>(e=>Boolean(e.schema))(e)?e:A(e.id,t,s))),T=e=>e.map((e=>e.id)),k=(e,t)=>e.find((({id:e})=>e===t)),z={pageSize:10,pageIndex:0},P={id:"",casesFeatureId:"",columns:[],sort:[],getRenderCellValue:()=>()=>null},B=({tableProps:e,initialBulkActionsState:t})=>Object(m.jsx)(d.a.Provider,{value:t},Object(m.jsx)(c.AlertsTable,e)),L=n.a.memo(B),M=[{field:"*",include_unmapped:!0}],R=({alertsTableConfigurationRegistry:e,configurationId:t,id:s,featureIds:c,flyoutSize:d,query:b,pageSize:g,showExpandToDetails:j,showAlertStatusWithFlapping:f})=>{var C,w,h,E,k,B,R,D,U;const{cases:V}=Object(r.useKibana)().services,_=null!==(C=null==e?void 0:e.has(t))&&void 0!==C&&C,Q=_?e.get(t):P,q=Object(l.useRef)(new a.Storage(window.localStorage)),G=q.current.get(s),K=null==Q||null===(w=Q.usePersistentControls)||void 0===w?void 0:w.call(Q),W=null!==(h=null==Q?void 0:Q.showInspectButton)&&void 0!==h&&h,N=G&&G.columns&&!Object(o.isEmpty)(null==G?void 0:G.columns)?null!==(E=null==G?void 0:G.columns)&&void 0!==E?E:[]:null!==(k=null==Q?void 0:Q.columns)&&void 0!==k?k:[],$=Object(l.useRef)({columns:N,sort:G&&G.sort&&!Object(o.isEmpty)(null==G?void 0:G.sort)?null!==(B=null==G?void 0:G.sort)&&void 0!==B?B:[]:null!==(R=null==Q?void 0:Q.sort)&&void 0!==R?R:[],visibleColumns:G&&G.visibleColumns&&!Object(o.isEmpty)(null==G?void 0:G.visibleColumns)?null!==(D=null==G?void 0:G.visibleColumns)&&void 0!==D?D:[]:N.map((e=>e.id))}),[H,J]=Object(l.useState)($.current.sort),[X,Y]=Object(l.useState)({...z,pageSize:null!=g?g:z.pageSize}),{columns:Z,onColumnsChange:ee,browserFields:te,isBrowserFieldDataLoading:se,onToggleColumn:le,onResetColumns:ne,visibleColumns:oe,onChangeVisibleColumns:ie}=(({featureIds:e,storageAlertsTable:t,storage:s,id:n,defaultColumns:o})=>{const[i,a]=(({featureIds:e})=>{const{http:t,notifications:{toasts:s}}=Object(y.b)().services,[n,o]=Object(l.useState)(void 0),[i,a]=Object(l.useState)((()=>({}))),r=Object(l.useCallback)((async()=>{if(!t)return Promise.resolve({});try{return await t.get(`${S.a}/browser_fields`,{query:{featureIds:e}})}catch(e){return s.addDanger(I.b),{}}}),[e,t,s]);return Object(l.useEffect)((()=>{void 0!==n||e.includes("siem")||(o(!0),(async()=>{const e=await r();a(e),o(!1)})())}),[r,n,e]),[n,i]})({featureIds:e}),[r,u]=Object(l.useState)(t.current.columns),[c,d]=Object(l.useState)(!1);Object(l.useEffect)((()=>{if(!1!==i||c)return;const e=F(r,a,o);d(!0),u(e)}),[a,r,o,i,c]);const b=Object(l.useCallback)((e=>{u(e),(({id:e,storageAlertsTable:t,columns:s,storage:l})=>{t.current={...t.current,columns:s},l.current.set(e,t.current)})({id:n,storage:s,storageAlertsTable:t,columns:e})}),[n,s,t]),g=Object(l.useCallback)((e=>{const t=((e,t)=>t.map((t=>e.find((e=>e.id===t)))).filter(Boolean))(r,e);b(t)}),[b,r]),j=Object(l.useCallback)((e=>{const t=(({column:e,columns:t,defaultColumns:s})=>{const l=t.findIndex((t=>t.id===e.id));return l>=0?(({columns:e,index:t})=>[...e.slice(0,t),...e.slice(t+1)])({columns:t,index:l}):(({column:e,columns:t,defaultColumns:s})=>{const l=s.findIndex((t=>t.id===e.id));return l>=0?[...t.slice(0,l),e,...t.slice(l)]:[t[0],e,...t.slice(1)]})({defaultColumns:s,column:e,columns:t})})({column:A(e,a,o),columns:r,defaultColumns:o});b(t)}),[a,r,o,b]),p=Object(l.useCallback)((()=>{const e=F(o,a,o);b(e)}),[a,o,b]);return{columns:r,visibleColumns:T(r),isBrowserFieldDataLoading:i,browserFields:a,onColumnsChange:b,onToggleColumn:j,onResetColumns:p,onChangeVisibleColumns:g}})({featureIds:c,storageAlertsTable:$,storage:q,id:s,defaultColumns:null!==(U=Q&&Q.columns)&&void 0!==U?U:[]}),[ae,{alerts:re,isInitializing:ue,getInspectQuery:ce,refetch:de,totalAlerts:be,updatedAt:ge}]=Object(u.a)({fields:M,featureIds:c,query:b,pagination:X,sort:H,skip:!1}),je=Object(l.useCallback)((e=>{Y(e)}),[]),pe=Object(l.useReducer)(v,{rowSelection:new Map,isAllSelected:!1,areAllVisibleRowsSelected:!1,rowCount:re.length}),me=Object(l.useCallback)((e=>{const t=e.map((e=>({[e.id]:{order:e.direction}})));$.current={...$.current,sort:t},q.current.set(s,$.current),J(t)}),[s]),fe=Object(l.useCallback)((()=>({activePage:X.pageIndex,alerts:re,alertsCount:be,isInitializing:ue,isLoading:ae,getInspectQuery:ce,onPageChange:je,onSortChange:me,refresh:de,sort:H,updatedAt:ge})),[re,be,ce,ue,ae,je,me,X.pageIndex,de,H,ge]),Ce=Object(l.useMemo)((()=>({alertsTableConfiguration:Q,columns:Z,bulkActions:[],deletedEventIds:[],disabledCellActions:[],flyoutSize:d,pageSize:X.pageSize,pageSizeOptions:[10,20,50,100],id:s,leadingControlColumns:[],showExpandToDetails:j,showAlertStatusWithFlapping:f,trailingControlColumns:[],useFetchAlertsData:fe,visibleColumns:oe,"data-test-subj":"internalAlertsState",updatedAt:ge,browserFields:te,onToggleColumn:le,onResetColumns:ne,onColumnsChange:ee,onChangeVisibleColumns:ie,controls:K,showInspectButton:W})),[Q,Z,d,X.pageSize,s,j,f,fe,oe,ge,te,le,ne,ee,ie,K,W]),Oe=null==V?void 0:V.ui.getCasesContext(),xe=function(e){var t;const[s,n]=Object(l.useState)({all:!1,read:!1,create:!1,update:!1,delete:!1,push:!1}),o=null===(t=Object(r.useKibana)().services.application)||void 0===t?void 0:t.capabilities,i=Object(r.useKibana)().services.cases.helpers.getUICapabilities(o[e]);return Object(l.useEffect)((()=>{n({all:i.all,create:i.create,read:i.read,update:i.update,delete:i.delete,push:i.push})}),[i.all,i.create,i.read,i.update,i.delete,i.push]),s}(Q.casesFeatureId);return _?Object(m.jsx)(n.a.Fragment,null,!ae&&0===be&&Object(m.jsx)(p.b,null,Object(m.jsx)(O,{controls:K,getInspectQuery:ce,showInpectButton:W})),(ae||se)&&Object(m.jsx)(i.EuiProgress,{size:"xs",color:"accent","data-test-subj":"internalAlertsPageLoading"}),0!==be&&Oe&&V&&Object(m.jsx)(Oe,{owner:[t],permissions:xe,features:{alerts:{sync:!1}}},Object(m.jsx)(L,{tableProps:Ce,initialBulkActionsState:pe})),0!==be&&(!Oe||!V)&&Object(m.jsx)(L,{tableProps:Ce,initialBulkActionsState:pe})):Object(m.jsx)(i.EuiEmptyPrompt,{"data-test-subj":"alertsTableNoConfiguration",iconType:"watchesApp",title:Object(m.jsx)("h2",null,x.b),body:Object(m.jsx)("p",null,x.a)})}},246:function(e,t,s){e.exports=s.p+"94cccf20036d014924e63d4d595e88e1.svg"}}]);