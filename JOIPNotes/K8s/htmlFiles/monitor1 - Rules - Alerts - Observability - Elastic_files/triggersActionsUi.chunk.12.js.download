/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[12,50],{122:function(e,t,n){"use strict";n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return r}));const a=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},s=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.execute},c=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function u(e,t){var n,a;return null!==(n=null==t||null===(a=t.authorizedConsumers[e])||void 0===a?void 0:a.all)&&void 0!==n&&n}const r=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},130:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(28);async function s({http:e}){return await e.get(`${a.a}/_config`)}},152:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(19),s=n(2);function i(e){return!1===(null==e?void 0:e.enabledInLicense)?(e=>({isEnabled:!1,message:s.i18n.translate("xpack.triggersActionsUI.checkRuleTypeEnabled.ruleTypeDisabledByLicenseMessage",{defaultMessage:"This rule type requires a {minimumLicenseRequired} license.",values:{minimumLicenseRequired:Object(a.upperFirst)(e.minimumLicenseRequired)}})}))(e):{isEnabled:!0}}},85:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var a=n(1),s=n.n(a),i=n(23),c=n(3),u=n(2),r=n(19),l=n(18),o=n(161),d=n(153),j=n(134),b=n(62),f=n(140),m=n(0);const v=({onConfirm:e,onCancel:t})=>Object(m.jsx)(c.EuiConfirmModal,{title:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveTitle",{defaultMessage:"Save rule with no actions?"}),onCancel:t,onConfirm:e,confirmButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveConfirmButtonText",{defaultMessage:"Save rule"}),cancelButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveCancelButtonText",{defaultMessage:"Cancel"}),defaultFocusedButton:"confirm","data-test-subj":"confirmRuleSaveModal"},Object(m.jsx)("p",null,Object(m.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveWithoutActionsMessage",defaultMessage:"You can add an action at anytime."})));var g=n(154),p=n(122),O=n(128);const y=({isSaving:e,onSave:t,onCancel:n,isFormLoading:a})=>{const{loadingHealthCheck:r}=Object(O.b)();return Object(m.jsx)(c.EuiFlyoutFooter,null,Object(m.jsx)(c.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiButtonEmpty,{"data-test-subj":"cancelSaveRuleButton",onClick:n},u.i18n.translate("xpack.triggersActionsUI.sections.ruleAddFooter.cancelButtonLabel",{defaultMessage:"Cancel"}))),a?Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiSpacer,{size:"s"}),Object(m.jsx)(c.EuiLoadingSpinner,{size:"l"})):Object(m.jsx)(s.a.Fragment,null),Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiButton,{fill:!0,color:"success","data-test-subj":"saveRuleButton",type:"submit",iconType:"check",isDisabled:r,isLoading:e,onClick:t},Object(m.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleAddFooter.saveButtonLabel",defaultMessage:"Save"})))))};var x=n(25),E=n(155),S=n(135),h=n(4),T=n(130),C=n(165);const I=({consumer:e,ruleTypeRegistry:t,actionTypeRegistry:n,onClose:s,canChangeTrigger:I,ruleTypeId:R,initialValues:A,reloadRules:F,onSave:M,metadata:k,filteredRuleTypes:w,...B})=>{var U;const L=null!=M?M:F,[D,N]=Object(a.useState)(k),_=Object(a.useCallback)((e=>N(e)),[]),z=Object(a.useMemo)((()=>({params:{},consumer:e,ruleTypeId:R,schedule:{interval:h.e},actions:[],tags:[],...A||{}})),[R,e,A]),[{rule:q},P]=Object(a.useReducer)(j.a,{rule:z}),[H,V]=Object(a.useState)({isUsingSecurity:!1}),[W,G]=Object(a.useState)({}),[Y,$]=Object(a.useState)(!1),[J,K]=Object(a.useState)(!1),[Q,X]=Object(a.useState)(!1),[Z,ee]=Object(a.useState)(B.ruleTypeIndex),[te,ne]=Object(a.useState)(!1),ae=(e,t)=>{P({command:{type:"setProperty"},payload:{key:e,value:t}})},{http:se,notifications:{toasts:ie},application:{capabilities:ce}}=Object(x.b)().services,ue=Object(p.f)(ce);Object(a.useEffect)((()=>{(async()=>{V(await Object(T.a)({http:se}))})()}),[se]),Object(a.useEffect)((()=>{R&&ae("ruleTypeId",R)}),[R]),Object(a.useEffect)((()=>{B.ruleTypeIndex||(async()=>{const e=await Object(b.u)({http:se}),t=new Map;for(const n of e)t.set(n.id,n);ee(t)})()}),[B.ruleTypeIndex,se]),Object(a.useEffect)((()=>{Object(r.isEmpty)(q.params)&&!Object(r.isEmpty)(W)?G({}):Object(r.isEmpty)(W)&&G(q.params)}),[q.params,W]);const[re,le]=Object(a.useState)([]),[oe,de]=Object(a.useState)(!1);Object(a.useEffect)((()=>{(async()=>{de(!0);const e=await Object(d.a)(q.actions,n);de(!1),le([...e])})()}),[q.actions,n]),Object(a.useEffect)((()=>{var e;!H.minimumScheduleInterval||null!=A&&null!==(e=A.schedule)&&void 0!==e&&e.interval||ae("schedule",{interval:Object(C.a)(H.minimumScheduleInterval.value)})}),[H.minimumScheduleInterval,A]),Object(a.useEffect)((()=>{if(q.ruleTypeId&&Z){const e=Z.get(q.ruleTypeId);null!=e&&e.defaultScheduleInterval&&!te&&ae("schedule",{interval:e.defaultScheduleInterval})}}),[q.ruleTypeId,Z,q.schedule.interval,te]),Object(a.useEffect)((()=>{q.schedule.interval===h.e||te||ne(!0)}),[q.schedule.interval,te]);const je=()=>{Object(E.a)(q,z,!1)||Object(E.b)(q.params,W)?X(!0):s(l.m.CANCELED,D)},be=async()=>{const e=await async function(){try{const e=await Object(b.i)({http:se,rule:q});return ie.addSuccess(u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveSuccessNotificationText",{defaultMessage:'Created rule "{ruleName}"',values:{ruleName:e.name}})),e}catch(n){var e,t;ie.addDanger(null!==(e=null===(t=n.body)||void 0===t?void 0:t.message)&&void 0!==e?e:u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveErrorNotificationText",{defaultMessage:"Cannot create rule."}))}}();$(!1),e&&(s(l.m.SAVED,D),L&&L(D))},fe=q.ruleTypeId?t.get(q.ruleTypeId):null,{ruleBaseErrors:me,ruleErrors:ve,ruleParamsErrors:ge}=Object(a.useMemo)((()=>Object(d.b)(q,fe,H)),[q,fe,H]),pe=ue&&0===(null===(U=q.actions)||void 0===U?void 0:U.length);return Object(m.jsx)(c.EuiPortal,null,Object(m.jsx)(c.EuiFlyout,{onClose:je,"aria-labelledby":"flyoutRuleAddTitle",size:"m",maxWidth:620,ownFocus:!0},Object(m.jsx)(c.EuiFlyoutHeader,{hasBorder:!0},Object(m.jsx)(c.EuiTitle,{size:"s","data-test-subj":"addRuleFlyoutTitle"},Object(m.jsx)("h3",{id:"flyoutTitle"},Object(m.jsx)(i.FormattedMessage,{defaultMessage:"Create rule",id:"xpack.triggersActionsUI.sections.ruleAdd.flyoutTitle"})))),Object(m.jsx)(O.a,null,Object(m.jsx)(f.a,{inFlyout:!0,waitForCheck:!0},Object(m.jsx)(c.EuiFlyoutBody,null,Object(m.jsx)(o.a,{rule:q,config:H,dispatch:P,errors:ve,canChangeTrigger:I,operation:u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.operationName",{defaultMessage:"create"}),actionTypeRegistry:n,ruleTypeRegistry:t,metadata:D,filteredRuleTypes:w,onChangeMetaData:_})),Object(m.jsx)(y,{isSaving:Y,isFormLoading:oe,onSave:async()=>{if($(!0),oe||!Object(d.c)(q,ve,re))return e=Object(S.a)(q,ge,me,re),P({command:{type:"setRule"},payload:{key:"rule",value:e}}),void $(!1);var e;pe?K(!0):await be()},onCancel:je}))),J&&Object(m.jsx)(v,{onConfirm:async()=>{K(!1),await be()},onCancel:()=>{$(!1),K(!1)}}),Q&&Object(m.jsx)(g.a,{onConfirm:()=>{X(!1),s(l.m.CANCELED,D)},onCancel:()=>{X(!1)}})))}}}]);